{"version":3,"file":"index.modern.js","sources":["../src/render/createElement.ts","../src/models/Hook.ts","../src/models/Point.ts","../src/models/Rect.ts","../src/models/Size.ts","../src/render/flattenChildren.ts","../src/render/havePropsChanged.ts","../src/render/minifyNode.ts","../src/paint/jobs/PaintJob.ts","../src/paint/getCanvas.ts","../src/paint/jobs/LayerJob.ts","../src/paint/jobs/LayerEndJob.ts","../src/paint/jobs/RectangleJob.ts","../src/paint/jobs/TextJob.ts","../src/paint/jobs/CircleJob.ts","../src/paint/jobs/PathJob.ts","../src/paint/jobs/PolygonJob.ts","../src/paint/jobs/FrameJob.ts","../src/paint/jobs/FrameEndJob.ts","../src/paint/jobs/GroupJob.ts","../src/paint/jobs/GroupEndJob.ts","../src/paint/buildPaintJobs.ts","../src/paint/paint.ts","../src/render/StateManager.ts","../src/render/Supervisor.ts","../src/PinkKoala.tsx","../src/hooks/haveArgsChanged.ts","../src/hooks/invokeOrReturn.ts","../src/hooks/getHookState.ts","../src/hooks/useEffect.ts","../src/hooks/useEventListener.ts","../src/hooks/useReducer.ts","../src/hooks/useState.ts","../src/hooks/useTicker.ts","../src/hooks/useRenderContext.ts","../src/hooks/useLayoutEffect.ts","../src/components/Layer.tsx","../src/components/Rectangle.tsx","../src/components/Circle.tsx","../src/components/Text.tsx","../src/render/translateFrame.ts","../src/components/Row.tsx","../src/components/Column.tsx","../src/components/Polygon.tsx","../src/components/Path.tsx","../src/components/Group.tsx"],"sourcesContent":["import { AttributeCollection } from \"../models\"\nimport { Node, mkRect, Rect } from \"../models\"\n\nexport var Fragment = \"fragment\"\n\n// const fontCanvas = document.createElement(\"canvas\")\n// const fontCtx = fontCanvas.getContext(\"2d\")!\n\nexport function createNode(\n    type: string | Function,\n    props: AttributeCollection,\n    children: Node[],\n    needsDraw: boolean = false\n): Node {\n    let node = createElement(type, props, ...children)\n    node.needsDraw = needsDraw\n    return node\n}\n\nexport function createElement(\n    type: string | Function,\n    props: AttributeCollection,\n    ...children: Node[]\n): Node {\n    let name: string = \"\"\n    if (typeof type === \"string\") {\n        name = type\n    } else if (typeof type === \"function\") {\n        name = type.name\n    }\n\n    // if ([\"text\", \"string\", \"pktext\"].includes(name)) {\n    //     if (children.length > 0) {\n    //         props.text = children.join(\" \")\n    //         children = []\n    //     }\n\n    //     // intrinsic width\n    //     if (props.font) {\n    //         fontCtx.textBaseline = \"top\"\n    //         fontCtx.font = props.font\n    //         let size = fontCtx.measureText(props.text || \"\")\n    //         if (size) {\n    //             props._intrinsicWidth = size.width\n    //             props._intrinsicHeight =\n    //                 size.fontBoundingBoxDescent - size.fontBoundingBoxAscent\n    //         }\n    //     }\n    // }\n\n    console.log(\"createElement\", name, props, children)\n\n    return {\n        type,\n        name,\n        props: {\n            ...props\n        },\n        children: children,\n        alternate: null,\n        hooks: [],\n        needsDraw: false,\n        cache: null,\n        frame: null\n    }\n}\n","import type { Node } from \"./Node\"\n\nexport type EffectHookCallback = () => EffectHookCallback | null | void\nexport type TickHookCallback = (now: number, delta: number) => void\n\nexport type Hook = {\n    state: any\n    queue: any[]\n    pendingEffects: EffectHookCallback[]\n    pendingTicks: EffectHookCallback[]\n    pendingUnmount: EffectHookCallback[]\n    pendingLayout: EffectHookCallback[]\n}\n\nexport function createHook(): Hook {\n    return {\n        state: {},\n        queue: [],\n        pendingEffects: [],\n        pendingTicks: [],\n        pendingUnmount: [],\n        pendingLayout: []\n    }\n}\n","export type Point = {\n\tx: number\n\ty: number\n}\n\nexport function mkPoint(x: number, y: number): Point {\n\treturn { x, y }\n}\n\nexport function pointLerp(a: Point, b: Point, t: number): Point {\n\treturn mkPoint(a.x + (b.x - a.x) * t, a.y + (b.y - a.y) * t)\n}\n\nexport function pointAt(p: Point, angle: number, distance: number): Point {\n\treturn pointLerp(\n\t\tp,\n\t\tmkPoint(\n\t\t\tp.x + Math.cos(angle) * distance,\n\t\t\tp.y + Math.sin(angle) * distance\n\t\t),\n\t\t1\n\t)\n}\n","import type { Point } from \"./Point\"\nimport { mkPoint } from \"./Point\"\n\nexport type Rect = {\n    x: number\n    y: number\n    width: number\n    height: number\n}\n\nexport function mkRect(\n    x: number,\n    y: number,\n    width: number,\n    height: number\n): Rect {\n    return { x, y, width, height }\n}\n\nexport function rectLeft(rect: Rect): number {\n    return rect.x\n}\n\nexport function rectRight(rect: Rect): number {\n    return rect.x + rect.width\n}\n\nexport function rectTop(rect: Rect): number {\n    return rect.y\n}\n\nexport function rectBottom(rect: Rect): number {\n    return rect.y + rect.height\n}\n\nexport function rectCenter(rect: Rect): Point {\n    return mkPoint(rect.x + rect.width / 2, rect.y + rect.height / 2)\n}\n\nexport function rectContains(rect: Rect, point: Point): boolean {\n    return (\n        point.x >= rectLeft(rect) &&\n        point.x <= rectRight(rect) &&\n        point.y >= rectTop(rect) &&\n        point.y <= rectBottom(rect)\n    )\n}\n\nexport function rectIntersects(a: Rect, b: Rect): boolean {\n    return (\n        rectLeft(a) <= rectRight(b) &&\n        rectRight(a) >= rectLeft(b) &&\n        rectTop(a) <= rectBottom(b) &&\n        rectBottom(a) >= rectTop(b)\n    )\n}\n","export type Size = {\n\twidth: number\n\theight: number\n}\n\nexport const mkSize = (width: number, height: number): Size => ({\n\twidth,\n\theight,\n})\n","export function flattenChildren<T>(children: any[]): T[] {\n    let nodes: any[] = []\n    if (Array.isArray(children)) {\n        for (let child of children) {\n            if (Array.isArray(child)) {\n                nodes = nodes.concat(flattenChildren(child))\n            } else if (child) {\n                nodes.push(child)\n            }\n        }\n    }\n    return nodes\n}\n","import type { AttributeCollection } from \"../models\"\n\nexport function havePropsChanged(\n\ta: AttributeCollection,\n\tb: AttributeCollection\n) {\n\tconst ignoreKeys = [\"__source\", \"__self\"]\n\tif (a === null || b === null) {\n\t\treturn true\n\t}\n\tfor (let key in a) {\n\t\tif (ignoreKeys.indexOf(key) === -1) {\n\t\t\tif (Array.isArray(a[key])) {\n\t\t\t\tif (a[key].length !== b[key].length) {\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t\tfor (let i = 0; i < a[key].length; i++) {\n\t\t\t\t\tif (havePropsChanged(a[key][i], b[key][i])) {\n\t\t\t\t\t\treturn true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (typeof a[key] === \"object\") {\n\t\t\t\tif (havePropsChanged(a[key], b[key])) {\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t} else if (a[key] !== b[key]) {\n\t\t\t\treturn true\n\t\t\t}\n\t\t}\n\t}\n\n\treturn false\n}\n","import type { Node } from \"../models\"\n\nexport function minifyNode(node: Node): Node {\n    let mini = {\n        name: node.name,\n        type: node.type,\n        props: node.props,\n        children: node.children,\n        alternate: null,\n        hooks: node.hooks,\n        needsDraw: false,\n        cache: node.cache,\n        frame: node.frame\n    }\n    return pruneGrandChildren(mini)\n}\n\nexport function pruneGrandChildren(node: Node): Node {\n    let children = node.children.map((child) => {\n        let mini = minifyNode(child)\n        if (mini.children.length > 0) {\n            mini.children = mini.children.map((grandChild) => {\n                return minifyNode(grandChild)\n            })\n        }\n        return mini\n    })\n    node.children = children\n    return node\n}\n","import { Node } from \"../../models\"\nimport type { AttributeCollection } from \"../../models/AttributeCollection\"\n\ntype PaintContext = {\n\tcanvas: HTMLCanvasElement | null\n\tcanvasStack: HTMLCanvasElement[]\n}\n\nlet paintContext: PaintContext = {\n\tcanvas: null,\n\tcanvasStack: [],\n}\n\nexport class PaintJob {\n\tpublic node: Node\n\n\tpublic name: string\n\n\tconstructor(node: Node) {\n\t\tthis.name = \"PaintJob\"\n\t\tthis.node = node\n\t}\n\n\tpublic doPainting() {\n\t\tthis.paint()\n\t}\n\n\tpublic paint() {}\n\n\tpublic get canvas(): HTMLCanvasElement | null {\n\t\treturn paintContext.canvas\n\t}\n\n\tpublic set canvas(val: HTMLCanvasElement | null) {\n\t\tpaintContext.canvas = val\n\t}\n\n\tpublic get paintingContext(): PaintContext {\n\t\treturn paintContext\n\t}\n\n\tpublic pushCanvas(canvas: HTMLCanvasElement) {\n\t\tpaintContext.canvasStack.push(canvas)\n\t}\n\n\tpublic popCanvas(): HTMLCanvasElement | null {\n\t\tlet c = paintContext.canvasStack.pop()\n\t\tif (c) {\n\t\t\treturn c\n\t\t} else {\n\t\t\treturn null\n\t\t}\n\t}\n\n\tpublic updateRenderingContextFromProps(\n\t\tctx: any,\n\t\tprops: AttributeCollection\n\t): PaintJobRenderingContextUpdate {\n\t\tlet hasChanged = false\n\t\tlet shouldFill = false\n\t\tlet shouldStroke = false\n\n\t\tconst map: AttributeCollection = {\n\t\t\tfill: \"fillStyle\",\n\t\t\tstroke: \"strokeStyle\",\n\t\t\tstrokeWidth: \"lineWidth\",\n\t\t\tfont: \"font\",\n\t\t}\n\n\t\tfor (let key in map) {\n\t\t\tlet ctxKey = map[key]\n\t\t\tif (props[key] && ctx[ctxKey] !== props[key]) {\n\t\t\t\tctx[ctxKey] = props[key]\n\t\t\t\thasChanged = true\n\t\t\t}\n\t\t\tif (key === \"fill\" && props[key]) {\n\t\t\t\tshouldFill = true\n\t\t\t}\n\t\t\tif (key === \"stroke\" && props[key]) {\n\t\t\t\tshouldStroke = true\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\thasChanged,\n\t\t\tshouldFill,\n\t\t\tshouldStroke,\n\t\t}\n\t}\n}\n\nexport interface PaintJobRenderingContextUpdate {\n\thasChanged: boolean\n\tshouldFill: boolean\n\tshouldStroke: boolean\n}\n","import { getSharedSupervisor } from \"../render/Supervisor\"\n\nexport function getCanvas(id: string): HTMLCanvasElement | undefined {\n    let sup = getSharedSupervisor()\n    const canvases = sup.canvases\n    const canvas = canvases.find((c) => c.id === id)\n    return canvas\n}\n","import { PaintJob } from \"./PaintJob\"\nimport { Node } from \"../../models\"\nimport { getCanvas } from \"../getCanvas\"\nlet canvasId = 0\n\nexport class LayerJob extends PaintJob {\n\tconstructor(node: Node) {\n\t\tsuper(node)\n\t\tthis.name = \"LayerJob\"\n\t}\n\n\tpublic paint() {\n\t\tlet canvas = getCanvas(this.node.props.id)\n\t\tif (canvas) {\n\t\t\tlet tmpCanvas = this.node.cache as HTMLCanvasElement | null\n\t\t\tif (!tmpCanvas) {\n\t\t\t\ttmpCanvas = document.createElement(\"canvas\")\n\t\t\t\ttmpCanvas.id = `tmp-layer-canvas-${canvasId++}`\n\t\t\t\ttmpCanvas.height = canvas.height\n\t\t\t\ttmpCanvas.width = canvas.width\n\t\t\t\tthis.node.cache = tmpCanvas\n\t\t\t}\n\t\t\tlet tmpContext = tmpCanvas.getContext(\"2d\")\n\t\t\tif (tmpContext) {\n\t\t\t\ttmpContext.clearRect(0, 0, tmpCanvas.width, tmpCanvas.height)\n\t\t\t\tthis.canvas = tmpCanvas\n\t\t\t}\n\t\t}\n\t}\n}\n","import { PaintJob } from \"./PaintJob\"\nimport { Node } from \"../../models\"\nimport { getCanvas } from \"../getCanvas\"\n\nexport class LayerEndJob extends PaintJob {\n\tconstructor(node: Node) {\n\t\tsuper(node)\n\t\tthis.name = \"LayerEndJob\"\n\t}\n\n\tpublic paint() {\n\t\tlet canvas = getCanvas(this.node.props.id)\n\t\tif (canvas) {\n\t\t\tlet origContext = canvas.getContext(\"2d\")!\n\t\t\torigContext.clearRect(0, 0, canvas.width, canvas.height)\n\t\t\torigContext.drawImage(this.node.cache, 0, 0)\n\n\t\t\t// reset the paint context canvas\n\t\t\tthis.canvas = canvas\n\t\t}\n\t}\n}\n","import { PaintJob } from \"./PaintJob\"\nimport { Node } from \"../../models\"\n\nexport class RectangleJob extends PaintJob {\n    constructor(node: Node) {\n        super(node)\n        this.name = \"RectangleJob\"\n    }\n\n    public paint() {\n        // parse attributes\n        let frm = this.node.frame!\n\n        // get context\n        if (this.canvas) {\n            let ctx = this.canvas.getContext(\"2d\")!\n            let cu = this.updateRenderingContextFromProps(ctx, this.node.props)\n            if (cu.hasChanged) {\n                ctx.save()\n            }\n\n            ctx.beginPath()\n\n            // fill\n            if (cu.shouldFill) {\n                console.log(\n                    \"RectanbleJob.paint fill\",\n                    frm.x,\n                    frm.y,\n                    frm.width,\n                    frm.height\n                )\n                ctx.fillRect(frm.x, frm.y, frm.width, frm.height)\n            }\n\n            // stroke\n            if (cu.shouldStroke) {\n                ctx.strokeRect(frm.x, frm.y, frm.width, frm.height)\n            }\n\n            if (cu.hasChanged) {\n                ctx.restore()\n            }\n        }\n    }\n}\n","import { PaintJob } from \"./PaintJob\"\nimport { Node } from \"../../models\"\n\nexport class TextJob extends PaintJob {\n    constructor(node: Node) {\n        super(node)\n        this.name = \"TextJob\"\n    }\n\n    public paint() {\n        // parse attributes\n        let x = this.node.frame!.x\n        let y = this.node.frame!.y\n        let text = (this.node.props.text as string) || \"\"\n\n        // get context\n        if (this.canvas) {\n            let ctx = this.canvas.getContext(\"2d\")!\n            let cu = this.updateRenderingContextFromProps(ctx, this.node.props)\n            if (cu.hasChanged) {\n                ctx.save()\n            }\n\n            ctx.beginPath()\n            let tm = ctx.measureText(text)\n            y = y + tm.actualBoundingBoxAscent\n\n            // fill\n            if (cu.shouldFill) {\n                ctx.fillText(text, x, y)\n            }\n\n            // stroke\n            if (cu.shouldStroke) {\n                ctx.strokeText(text, x, y)\n            }\n\n            if (cu.hasChanged) {\n                ctx.restore()\n            }\n        }\n    }\n}\n","import { PaintJob } from \"./PaintJob\"\nimport { Node } from \"../../models\"\n\nexport class CircleJob extends PaintJob {\n    constructor(node: Node) {\n        super(node)\n        this.name = \"CircleJob\"\n    }\n\n    public paint() {\n        let frm = this.node.frame!\n\n        // parse attributes\n        let radius = frm.width / 2\n\n        // get context\n        if (this.canvas) {\n            let ctx = this.canvas.getContext(\"2d\")!\n            let cu = this.updateRenderingContextFromProps(ctx, this.node.props)\n            if (cu.hasChanged) {\n                ctx.save()\n            }\n\n            // path\n            ctx.beginPath()\n            ctx.ellipse(\n                frm.x + radius,\n                frm.y + radius,\n                radius,\n                radius,\n                0,\n                0,\n                2 * Math.PI\n            )\n\n            // fill\n            if (cu.shouldFill) {\n                ctx.fill()\n            }\n\n            // stroke\n            if (cu.shouldStroke) {\n                ctx.stroke()\n            }\n\n            if (cu.hasChanged) {\n                ctx.restore()\n            }\n        }\n    }\n}\n","import { PaintJob } from \"./PaintJob\"\nimport { Node, Points } from \"../../models\"\n\nexport class PathJob extends PaintJob {\n    constructor(node: Node) {\n        super(node)\n        this.name = \"PathJob\"\n    }\n\n    public paint() {\n        let frm = this.node.frame!\n\n        // parse attributes\n        let closePath = this.node.props.closed ? this.node.props.closed : false\n        let path: Points = (this.node.props.path as Points) || []\n\n        // get context\n        if (this.canvas) {\n            let ctx = this.canvas.getContext(\"2d\")!\n            let cu = this.updateRenderingContextFromProps(ctx, this.node.props)\n\n            // save context\n            if (cu.hasChanged) {\n                ctx.save()\n            }\n\n            // path\n            ctx.beginPath()\n            let i = 0\n            for (let pt of path) {\n                if (i === 0) {\n                    ctx.moveTo(frm.x + pt.x, frm.y + pt.y)\n                } else {\n                    ctx.lineTo(frm.x + pt.x, frm.y + pt.y)\n                }\n                i++\n            }\n\n            // close path\n            if (closePath) {\n                ctx.closePath()\n            }\n\n            // fill\n            if (cu.shouldFill) {\n                ctx.fill()\n            }\n\n            // stroke\n            if (cu.shouldStroke) {\n                ctx.stroke()\n            }\n\n            // restore context\n            if (cu.hasChanged) {\n                ctx.restore()\n            }\n        }\n    }\n}\n","import { PaintJob } from \"./PaintJob\"\nimport { Node, Points, mkPoint, pointAt } from \"../../models\"\n\nexport class PolygonJob extends PaintJob {\n    constructor(node: Node) {\n        super(node)\n        this.name = \"PolygonJob\"\n    }\n\n    public paint() {\n        let frm = this.node.frame!\n\n        // parse attributes\n        let radius = frm.width / 2\n        let sides = parseFloat(this.node.props.sides as string) || 5\n\n        let center = mkPoint(frm.x + radius, frm.y + radius)\n        let angle = (Math.PI * 2) / sides\n\n        let path: Points = []\n        for (let i = 0; i < sides; i++) {\n            let pt = pointAt(center, angle * i, radius)\n            path.push(pt)\n        }\n\n        // get context\n        if (this.canvas) {\n            let ctx = this.canvas.getContext(\"2d\")!\n            let cu = this.updateRenderingContextFromProps(ctx, this.node.props)\n\n            // save context\n            if (cu.hasChanged) {\n                ctx.save()\n            }\n\n            // build path\n            ctx.beginPath()\n            let i = 0\n            for (let pt of path) {\n                if (i === 0) {\n                    ctx.moveTo(pt.x, pt.y)\n                } else {\n                    ctx.lineTo(pt.x, pt.y)\n                }\n                if (i === path.length - 1) {\n                    ctx.closePath()\n                }\n                i++\n            }\n\n            // fill\n            if (cu.shouldFill) {\n                ctx.fill()\n            }\n\n            // stroke\n            if (cu.shouldStroke) {\n                ctx.stroke()\n            }\n\n            // restore\n            if (cu.hasChanged) {\n                ctx.restore()\n            }\n        }\n    }\n}\n","import { PaintJob } from \"./PaintJob\"\nimport { Node } from \"../../models\"\n\nexport class FrameJob extends PaintJob {\n\tconstructor(node: Node) {\n\t\tsuper(node)\n\t\tthis.name = \"FrameJob\"\n\t}\n\n\tpublic paint() {\n\t\tconsole.log(\"Frame Job\", this.node)\n\t}\n}\n","import { PaintJob } from \"./PaintJob\"\nimport { Node } from \"../../models\"\n\nexport class FrameEndJob extends PaintJob {\n\tconstructor(node: Node) {\n\t\tsuper(node)\n\t\tthis.name = \"FrameEndJob\"\n\t}\n\n\tpublic paint() {\n\t\tconsole.log(\"FrameEnd Job\", this.node)\n\t}\n}\n","import { PaintJob } from \"./PaintJob\"\nimport { Node } from \"../../models\"\n\nlet groupId = 0\nexport class GroupJob extends PaintJob {\n    constructor(node: Node) {\n        super(node)\n        this.name = \"GroupJob\"\n    }\n\n    public paint() {\n        let frm = this.node.frame!\n\n        if (this.canvas) {\n            this.pushCanvas(this.canvas)\n            let tmpCanvas = this.node.cache as HTMLCanvasElement | null\n            if (!tmpCanvas) {\n                tmpCanvas = document.createElement(\"canvas\")\n                tmpCanvas.id = `tmp-group-canvas-${groupId++}`\n                tmpCanvas.height = frm.height\n                tmpCanvas.width = frm.width\n                this.node.cache = tmpCanvas\n            }\n            let tmpContext = tmpCanvas.getContext(\"2d\")\n            if (tmpContext) {\n                tmpContext.clearRect(frm.x, frm.y, frm.width, frm.height)\n                this.canvas = tmpCanvas\n            }\n        }\n    }\n}\n","import { PaintJob } from \"./PaintJob\"\nimport { Node } from \"../../models\"\n\nexport class GroupEndJob extends PaintJob {\n    constructor(node: Node) {\n        super(node)\n        this.name = \"GroupEndJob\"\n    }\n\n    public paint() {\n        let frm = this.node.frame!\n\n        if (this.node.needsDraw) {\n            let canvas = this.popCanvas()\n            if (canvas) {\n                let origContext = canvas.getContext(\"2d\")!\n                origContext.drawImage(this.node.cache, frm.x, frm.y)\n\n                // reset the paint context canvas\n                this.canvas = canvas\n            }\n        } else {\n            let canvas = this.canvas\n            if (canvas && this.node.cache) {\n                let ctx = canvas.getContext(\"2d\")\n                ctx?.drawImage(this.node.cache, frm.x, frm.y)\n            }\n        }\n    }\n}\n","import {\n    PaintJob,\n    LayerJob,\n    LayerEndJob,\n    RectangleJob,\n    TextJob,\n    CircleJob,\n    PathJob,\n    PolygonJob,\n    FrameJob,\n    FrameEndJob,\n    GroupJob,\n    GroupEndJob\n} from \"./jobs\"\nimport { Node } from \"../models\"\n\nexport function buildPaintJobs(node: Node): PaintJob[] {\n    let jobs: PaintJob[] = []\n\n    if (node.needsDraw) {\n        // paint jobs\n        switch (node.name) {\n            case \"layer\":\n            case \"pklayer\":\n                jobs.push(new LayerJob(node))\n                break\n\n            case \"frame\":\n            case \"pkframe\":\n                jobs.push(new FrameJob(node))\n                break\n\n            case \"Group\":\n            case \"group\":\n            case \"pkgroup\":\n                jobs.push(new GroupJob(node))\n                break\n\n            case \"Rectangle\":\n            case \"rect\":\n            case \"pkrect\":\n            case \"rectangle\":\n            case \"pkrectangle\":\n                jobs.push(new RectangleJob(node))\n                break\n\n            case \"string\":\n            case \"pkstring\":\n            case \"text\":\n            case \"pktext\":\n                jobs.push(new TextJob(node))\n                break\n\n            case \"Circle\":\n            case \"circle\":\n            case \"pkcircle\":\n                jobs.push(new CircleJob(node))\n                break\n\n            case \"Path\":\n            case \"path\":\n            case \"pkpath\":\n                jobs.push(new PathJob(node))\n                break\n\n            case \"Polygon\":\n            case \"polygon\":\n            case \"pkpolygon\":\n                jobs.push(new PolygonJob(node))\n                break\n        }\n\n        // children jobs\n        for (let child of node.children) {\n            jobs = jobs.concat(buildPaintJobs(child))\n        }\n\n        // cleanup jobs\n        switch (node.name) {\n            case \"layer\":\n            case \"pklayer\":\n                jobs.push(new LayerEndJob(node))\n                break\n\n            case \"frame\":\n            case \"pkframe\":\n                jobs.push(new FrameEndJob(node))\n                break\n\n            case \"Group\":\n            case \"group\":\n            case \"pkgroup\":\n                jobs.push(new GroupEndJob(node))\n                break\n        }\n    } else {\n        // some items still need to draw from cache\n        switch (node.name) {\n            case \"Group\":\n            case \"group\":\n            case \"pkgroup\":\n                jobs.push(new GroupEndJob(node))\n                break\n        }\n    }\n\n    return jobs\n}\n","import { Node } from \"../models\"\nimport { PaintJob } from \"./jobs\"\nimport { buildPaintJobs } from \"./buildPaintJobs\"\n\nlet queue: PaintJob[] = []\n\nexport function paint(node: Node): void {\n\tif (queue.length === 0) {\n\t\tqueue = buildPaintJobs(node)\n\t\tpaintLoop()\n\t}\n}\n\nexport function paintLoop() {\n\tlet job: PaintJob | undefined | null = null\n\twhile (queue.length > 0) {\n\t\tjob = queue.shift()\n\t\tif (job) {\n\t\t\tjob.doPainting()\n\t\t}\n\t}\n}\n","import { mkRect, mkSize, Node, Size, Rect } from \"../models\"\nimport type { AttributeCollection } from \"../models\"\nimport { flattenChildren } from \"./flattenChildren\"\nimport { havePropsChanged } from \"./havePropsChanged\"\nimport { minifyNode } from \"./minifyNode\"\nimport { paint } from \"../paint\"\n\ntype ChildrenDiff = {\n    children: Node[]\n    removed: Node[]\n}\n\nexport class StateManager {\n    public AUTO_LOOP = true\n\n    private paintCount = 0\n\n    public size: Size = mkSize(10, 10)\n    private _nodeFrame: Rect = mkRect(0, 0, 10, 10)\n\n    public _root: Node | null = null\n\n    private _node: Node | null = null\n\n    public currentRoot: Node | null = null\n\n    public unitsOfWork: Node[] = []\n\n    public isRunning = false\n\n    public hasUpdateBeenRequested = false\n\n    public stepCallbackId: number | null = null\n\n    // for hooks\n    public hookIndex: number = 0\n\n    public get root(): Node | null {\n        return this._root\n    }\n\n    public get node(): Node | null {\n        return this._node\n    }\n\n    public set node(val: Node | null) {\n        this._node = val\n    }\n\n    public setRoot(fn: any) {\n        this._root = {\n            name: \"root\",\n            type: fn,\n            props: {},\n            children: [],\n            alternate: null,\n            hooks: [],\n            needsDraw: false,\n            cache: null,\n            frame: mkRect(0, 0, this.size.width, this.size.height)\n        }\n        this.unitsOfWork.push(this._root)\n    }\n\n    constructor() {\n        this.step = this.step.bind(this)\n        if (this.AUTO_LOOP === false) {\n            const onKeyUp = (e: KeyboardEvent) => {\n                if (e.key === \" \") {\n                    this.requestRootUpdate()\n                    let deadline = performance.now() + 16\n                    this.step({\n                        timeRemaining: () => deadline - performance.now(),\n                        didTimeout: false\n                    })\n                }\n            }\n            document.addEventListener(\"keyup\", onKeyUp)\n        }\n    }\n\n    public start() {\n        if (!this.isRunning) {\n            if (window.requestIdleCallback != null) {\n                this.stepCallbackId = requestIdleCallback(this.step)\n            } else {\n                setTimeout(() => {\n                    this.step({\n                        timeRemaining: () => {\n                            return 16\n                        },\n                        didTimeout: false\n                    })\n                }, 10)\n            }\n            this.isRunning = true\n        }\n    }\n\n    public stop() {\n        this.isRunning = false\n        if (this.stepCallbackId) {\n            cancelIdleCallback(this.stepCallbackId)\n            this.stepCallbackId = null\n        }\n    }\n\n    public step(deadline: IdleDeadline) {\n        let start = performance.now()\n\n        // timer based hooks\n        if (this.currentRoot) {\n            this.workTimerHooks(this.currentRoot)\n        }\n\n        if (this.unitsOfWork.length === 0 && this.hasUpdateBeenRequested) {\n            this.startRootUpdate()\n        }\n\n        while (this.unitsOfWork.length > 0 && deadline.timeRemaining() > 2) {\n            this.performNextUnitOfWork()\n        }\n\n        if (this.unitsOfWork.length === 0 && this._root != null) {\n            this.resolveIntrinsicFrames(this._root, null)\n            this.resolveCalculatedFrames(this._root, null)\n            this.workLayoutHooks(this._root)\n            this.commitRoot()\n        }\n\n        if (this.unitsOfWork.length === 0 && this._root === null) {\n            if (this.currentRoot) {\n                this.workEffectHooks(this.currentRoot)\n            }\n        }\n\n        if (this.stepCallbackId) {\n            cancelIdleCallback(this.stepCallbackId)\n            this.stepCallbackId = null\n        }\n        if ((this.isRunning && this.AUTO_LOOP) || this.unitsOfWork.length > 0) {\n            if (window.requestIdleCallback != null) {\n                this.stepCallbackId = requestIdleCallback(this.step)\n            } else {\n                setTimeout(() => {\n                    this.step({\n                        timeRemaining: () => {\n                            return 16\n                        },\n                        didTimeout: false\n                    })\n                }, 10)\n            }\n        }\n\n        let diff = performance.now() - start\n    }\n\n    public performNextUnitOfWork() {\n        let n = this.unitsOfWork.shift()\n        if (n) {\n            this._node = n\n        } else {\n            this._node = null\n        }\n        if (this._node) {\n            this.workEffectHooks(this._node, false)\n            let next: Node[] = this.updateNode(this._node)\n            for (let n of next) {\n                this.unitsOfWork.push(n)\n            }\n        }\n    }\n\n    public commitRoot() {\n        this.currentRoot = this._root\n        this._root = null\n        // TODO: hooks\n        // TODO: deletions\n        if (this.currentRoot) {\n            this.propigateNeedsDraw(this.currentRoot)\n            this.paintCount++\n            console.log(\"StateManager.commitRoot\")\n            //console.log(this.currentRoot)\n            this.debugFrames(this.currentRoot)\n            paint(this.currentRoot)\n        }\n    }\n\n    public resolveCalculatedFrames(node: Node, parent: Node | null): void {\n        if (parent && parent.frame && node.props && node.frame) {\n            if (node.name === \"fragment\") {\n                // create frames for fragments\n                node.frame = { ...parent.frame, x: 0, y: 0 }\n            }\n            // handle percentage based frames\n            let w = node.props.width\n            let r = node.props.radius\n            if (w && typeof w === \"string\" && node.props.width.includes(\"%\")) {\n                let wp = parseFloat(node.props.width) / 100\n                node.frame.width = parent.frame.width * wp\n            }\n            // handle radius property\n            if (!w && r) {\n                if (r && typeof r === \"string\" && r.includes(\"%\")) {\n                    let rp = parseFloat(r) / 100\n                    node.frame.width = parent.frame.width * rp * 2\n                } else {\n                    node.frame.width = parseFloat(r) * 2\n                }\n            }\n            let h = node.props.height\n            if (h && typeof h === \"string\" && node.props.height.includes(\"%\")) {\n                let hp = parseFloat(node.props.height) / 100\n                node.frame.height = parent.frame.height * hp\n            }\n            let x = node.props.x\n            if (x && typeof x === \"string\" && x.includes(\"%\")) {\n                let xp = parseFloat(node.props.x) / 100\n                let xPos = parent.frame.width * xp\n                node.frame.x = xPos\n            }\n            let y = node.props.y\n            if (y && typeof y === \"string\" && y.includes(\"%\")) {\n                let yp = parseFloat(node.props.y) / 100\n                let yPos = parent.frame.height * yp\n                node.frame.y = yPos\n            }\n\n            // translate x and y with parent values\n            node.frame.x = node.frame.x + parent.frame.x\n            node.frame.y = node.frame.y + parent.frame.y\n        }\n\n        for (let child of node.children) {\n            this.resolveCalculatedFrames(child, node)\n        }\n    }\n\n    public resolveIntrinsicFrames(node: Node, parent: Node | null): void {\n        for (let child of node.children) {\n            this.resolveIntrinsicFrames(child, node)\n        }\n\n        let frame = mkRect(0, 0, 0, 0)\n\n        if (node.props.x) {\n            frame.x = parseFloat(node.props.x)\n        }\n\n        if (node.props.y) {\n            frame.y = parseFloat(node.props.y)\n        }\n\n        frame.width = this.resolveWidth(node)\n        frame.height = this.resolveHeight(node)\n\n        node.frame = frame\n    }\n\n    public resolveWidth(node: Node): number {\n        let w = 0\n        if (node.frame && node.frame.width) {\n            w = node.frame.width\n        } else if (node.props.width) {\n            w = parseFloat(node.props.width)\n        } else if (node.props._intrinsicWidth) {\n            w = parseFloat(node.props._intrinsicWidth)\n        } else {\n            for (let child of node.children) {\n                w = Math.max(w, this.resolveWidth(child))\n            }\n        }\n        return w\n    }\n\n    public resolveHeight(node: Node): number {\n        let h = 0\n        if (node.frame && node.frame.height) {\n            h = node.frame.height\n        } else if (node.props.height) {\n            h = parseFloat(node.props.height)\n        } else if (node.props._intrinsicHeight) {\n            h = parseFloat(node.props._intrinsicHeight)\n        } else {\n            for (let child of node.children) {\n                h = Math.max(h, this.resolveHeight(child))\n            }\n        }\n        return h\n    }\n\n    public debugFrames(node: Node, depth: number = 0) {\n        let indent = \"\".padEnd(depth * 4, \" \")\n        if (node.frame) {\n            console.log(\n                indent,\n                node.name,\n                \"x:\",\n                node.frame.x,\n                \", y:\",\n                node.frame.y,\n                \"- w:\",\n                node.frame.width,\n                \", h:\",\n                node.frame.height\n            )\n        } else {\n            console.log(indent, node.name, \"no-frame\", node)\n        }\n\n        for (let child of node.children) {\n            this.debugFrames(child, depth + 1)\n        }\n    }\n\n    public requestRootUpdate(): void {\n        this.hasUpdateBeenRequested = true\n    }\n\n    public startRootUpdate() {\n        this.hasUpdateBeenRequested = false\n        if (this.currentRoot) {\n            this._nodeFrame = mkRect(0, 0, this.size.width, this.size.height)\n            this._root = {\n                name: \"root\",\n                type: this.currentRoot.type,\n                props: {\n                    ...this.currentRoot.props,\n                    width: this.size.width,\n                    height: this.size.height\n                },\n                children: this.currentRoot.children,\n                alternate: minifyNode(this.currentRoot),\n                hooks: this.currentRoot.hooks,\n                needsDraw: false,\n                cache: null,\n                frame: null\n            }\n        }\n        if (this._root) {\n            this.unitsOfWork = [this._root]\n        }\n    }\n\n    workTimerHooks(node: Node) {\n        // children\n        for (let child of node.children) {\n            this.workTimerHooks(child)\n        }\n\n        for (let hook of node.hooks) {\n            for (let action of hook.pendingTicks) {\n                action()\n            }\n            hook.pendingTicks = []\n        }\n    }\n\n    workEffectHooks(node: Node, includeChildren: boolean = true) {\n        // children\n        if (includeChildren) {\n            for (let child of node.children) {\n                this.workEffectHooks(child)\n            }\n        }\n\n        for (let hook of node.hooks) {\n            for (let action of hook.pendingEffects) {\n                let unmount = hook.queue.pop()\n                if (unmount) {\n                    unmount()\n                }\n                let cb = action()\n                if (cb) {\n                    hook.queue.push(cb)\n                }\n            }\n            hook.pendingEffects = []\n        }\n    }\n\n    workLayoutHooks(node: Node) {\n        // children\n        for (let child of node.children) {\n            this.workLayoutHooks(child)\n        }\n\n        this._node = node\n        for (let hook of node.hooks) {\n            for (let action of hook.pendingLayout) {\n                action()\n            }\n            hook.pendingLayout = []\n        }\n        this._node = null\n    }\n\n    public updateNode(node: Node): Node[] {\n        if (!node.alternate) {\n            // new nodes need to be drawn\n            node.needsDraw = true\n        }\n\n        let prevChildren: Node[] = []\n        if (node.type instanceof Function) {\n            // reset hooks, they will be re-added by running the render function\n            this.hookIndex = 0\n            node.hooks = []\n\n            // get the previous children\n            if (node.alternate) {\n                prevChildren = node.alternate.children\n            } else if (node.children) {\n                prevChildren = node.children\n            }\n\n            // get the render function\n            let f = node.type as (\n                props: AttributeCollection,\n                children: any\n            ) => Node\n\n            // execute the render function, and get new children\n            node.children = [f(node.props, node.children)]\n        } else {\n            // for non-function nodes, just use the children\n            prevChildren = node.alternate ? node.alternate.children : []\n        }\n\n        // flatten the children\n        let nextChildren: Node[] = flattenChildren(node.children)\n\n        // diff the children\n        let childDiff = this.diffChildren(nextChildren, prevChildren)\n\n        // handle diffed children\n        node.children = childDiff.children\n\n        // TODO: handle removed children\n\n        // return the next children, for next units of work\n        return node.children\n    }\n\n    public propigateNeedsDraw(\n        parent: Node,\n        inherited: boolean = false\n    ): boolean {\n        let needsDraw =\n            parent.needsDraw ||\n            (inherited &&\n                ![\"pklayer\", \"layer\", \"group\", \"pkgroup\"].includes(parent.name))\n        // propigate up\n        for (let child of parent.children) {\n            needsDraw = needsDraw || this.propigateNeedsDraw(child, needsDraw)\n        }\n        // propigate down to all children\n        if (needsDraw) {\n            for (let child of parent.children) {\n                this.propigateNeedsDraw(child, true)\n            }\n        }\n        parent.needsDraw = needsDraw\n        return needsDraw\n    }\n\n    public diffChildren(\n        nextChildren: Node[],\n        prevChildren: Node[]\n    ): ChildrenDiff {\n        let children: Node[] = []\n        let removed: Node[] = []\n        let length = Math.max(nextChildren.length, prevChildren.length)\n\n        for (let i = 0; i < length; i++) {\n            let next = nextChildren[i]\n            let prev = prevChildren[i]\n            let nextNode = this.diffNode(next, prev)\n            if (nextNode) {\n                children.push(nextNode)\n            }\n            if (prev) {\n                if (!nextNode) {\n                    removed.push(prev)\n                }\n            }\n        }\n\n        return { children, removed }\n    }\n\n    public diffNode(a: Node | null, b: Node | null): Node | null {\n        let next: Node | null = null\n        let sameType = false\n        if (!!a && !!b) {\n            sameType = a.type == b.type\n        }\n\n        if (a && b && sameType) {\n            let needsDraw = false\n            if (havePropsChanged(a.props, b.props)) {\n                needsDraw = true\n            }\n            next = {\n                name: a.name,\n                type: a.type,\n                props: a.props,\n                children: a.children,\n                needsDraw: needsDraw,\n                hooks: b.hooks,\n                cache: b.cache,\n                alternate: minifyNode(b),\n                frame: b.frame\n            }\n        } else if (a && !sameType) {\n            next = {\n                name: a.name,\n                type: a.type,\n                props: a.props,\n                children: a.children,\n                alternate: null,\n                needsDraw: true,\n                hooks: [],\n                cache: null,\n                frame: a.frame\n            }\n        } else {\n            console.error(\"diffNode\", a, b, sameType)\n        }\n\n        return next\n    }\n}\n","import { StateManager } from \"./StateManager\"\n\nexport type Layer = {\n    child: any\n    canvases: any[]\n}\n\nexport class Supervisor {\n    public stateManager: StateManager\n\n    public canvases: HTMLCanvasElement[] = []\n\n    constructor() {\n        this.stateManager = new StateManager()\n    }\n\n    addLayer(layer: Layer) {\n        this.stateManager.setRoot(layer.child)\n        this.canvases = layer.canvases\n    }\n\n    public get currentContext(): StateManager | null {\n        return this.stateManager\n    }\n\n    public get activeLayer(): StateManager | null {\n        return this.stateManager\n    }\n\n    public start(): void {\n        this.activeLayer?.start()\n    }\n\n    public stop(): void {}\n}\n\nlet sharedSupervisor: Supervisor = new Supervisor()\nexport function getSharedSupervisor(): Supervisor {\n    return sharedSupervisor\n}\n","import React, { useRef, useEffect } from \"react\"\nimport type { Size, AttributeCollection } from \"./models/\"\nimport { getSharedSupervisor } from \"./render\"\nimport \"./PinkKoala.css\"\n\nexport type PinkKoalaProps = {\n    drawing: any\n    drawingProps: AttributeCollection | null\n    layers: string[]\n    size: Size\n}\n\nexport const PinkKoala = (props: PinkKoalaProps) => {\n    let containerRef = useRef<HTMLDivElement>(null)\n\n    useEffect(() => {\n        if (containerRef.current) {\n            const canvasNodes = containerRef.current.querySelectorAll(\"canvas\")\n            let canvases = Array.from(canvasNodes).map((node) => {\n                return node as HTMLCanvasElement\n            })\n\n            let sup = getSharedSupervisor()\n            sup.addLayer({\n                child: props.drawing,\n                canvases: canvases\n            })\n            sup.stateManager.size = props.size\n            sup.start()\n        }\n    }, [props.drawing, containerRef, props.size])\n\n    return (\n        <div ref={containerRef} className=\"PinkKoala\">\n            {props.layers.map((layer) => (\n                <canvas\n                    key={layer}\n                    id={layer}\n                    width={props.size.width}\n                    height={props.size.height}\n                />\n            ))}\n        </div>\n    )\n}\n","export function haveArgsChanged(a: any[], b: any[]) {\n\tif (!a && !b) {\n\t\treturn false\n\t}\n\tif ((!a && b) || (!b && a)) {\n\t\t//console.log(\"args changed nulls\", a, b)\n\t\treturn true\n\t}\n\tif (a.length !== b.length) {\n\t\t//console.log(\"args changed length\", a, b)\n\t\treturn true\n\t}\n\tfor (let i = 0; i < a.length; i++) {\n\t\tif (a[i] !== b[i]) {\n\t\t\t//console.log(\"args changed value\", a, b)\n\t\t\treturn true\n\t\t}\n\t}\n\t//console.log(\"args not chagned\", a, b)\n\treturn false\n}\n","export function invokeOrReturn(arg: any, f: any): any {\n\treturn typeof f == \"function\" ? f(arg) : f\n}\n","import type { Hook } from \"../models\"\nimport { StateManager } from \"../render/StateManager\"\nimport { getSharedSupervisor } from \"../render/Supervisor\"\n\ntype HookState = {\n\tcontext: StateManager | null\n\tprevHook: Hook | null\n}\n\nexport function getHookState(): HookState {\n\tlet hook: Hook | null = null\n\tlet context: StateManager | null = getSharedSupervisor().currentContext\n\n\tif (context) {\n\t\tif (context.node) {\n\t\t\thook =\n\t\t\t\tcontext.node.alternate &&\n\t\t\t\tcontext.node.alternate.hooks &&\n\t\t\t\tcontext.node.alternate.hooks[context.hookIndex]\n\t\t}\n\t}\n\n\treturn {\n\t\tcontext,\n\t\tprevHook: hook,\n\t}\n}\n","import type { EffectHookCallback } from \"../models\"\nimport { createHook } from \"../models\"\nimport { getHookState } from \"./getHookState\"\nimport { haveArgsChanged } from \"./haveArgsChanged\"\n\nexport function useEffect(callback: EffectHookCallback, args: any[]) {\n\tlet hookState = getHookState()\n\tlet prevHook = hookState.prevHook\n\tlet context = hookState.context\n\n\tif (!context || !context.node) {\n\t\tthrow new Error(\n\t\t\t\"useReducer must be called from within a render function\"\n\t\t)\n\t}\n\n\tlet hook = createHook()\n\tif (prevHook) {\n\t\thook.state = prevHook.state\n\t\thook.queue = prevHook.queue\n\t}\n\n\tif (haveArgsChanged(args, prevHook?.state)) {\n\t\thook.pendingEffects.push(callback)\n\t\thook.state = args\n\t}\n\tcontext.node.hooks.push(hook)\n\tcontext.hookIndex++\n}\n","import { useEffect } from \"./useEffect\"\n\nexport function useEventListener(event: string, handler: any, args: any[]) {\n\tuseEffect(() => {\n\t\tdocument.addEventListener(event, handler)\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(event, handler)\n\t\t}\n\t}, [...args, event, handler])\n}\n","import { createHook } from \"../models\"\nimport { getHookState } from \"./getHookState\"\nimport { invokeOrReturn } from \"./invokeOrReturn\"\n\ntype ReducerCallback = (state: any, action: any) => any\n\nexport function useReducer(\n    reducer: any,\n    initialState: any,\n    init: any = null\n): any[] {\n    let hookState = getHookState()\n    let prevHook = hookState.prevHook\n    let context = hookState.context\n\n    if (!context || !context.node) {\n        throw new Error(\n            \"useReducer must be called from within a render function\"\n        )\n    }\n\n    let hook = createHook()\n    if (init) {\n        hook.state = init(initialState)\n    } else {\n        hook.state = prevHook\n            ? prevHook.state\n            : invokeOrReturn(undefined, initialState)\n    }\n\n    const actions = prevHook ? prevHook.queue : []\n    for (let action of actions) {\n        hook.state = reducer(hook.state, action)\n    }\n    if (prevHook) {\n        prevHook.queue = []\n    }\n\n    const dispatch = (action: any) => {\n        hook.queue.push(action)\n        context?.requestRootUpdate()\n    }\n\n    context.node!.hooks.push(hook)\n    context.hookIndex++\n    return [hook.state, dispatch]\n}\n","import { useReducer } from \"./useReducer\"\nimport { createHook } from \"../models\"\nimport { getHookState } from \"./getHookState\"\nimport { invokeOrReturn } from \"./invokeOrReturn\"\n\nexport function useState(initialState: any): any[] {\n\treturn useReducer(invokeOrReturn, initialState)\n}\n","import { getHookState } from \"./getHookState\"\nimport { createHook } from \"../models\"\nimport type { EffectHookCallback, TickHookCallback } from \"../models\"\n\nexport function useTicker(callback: TickHookCallback) {\n\tlet hookState = getHookState()\n\tlet prevHook = hookState.prevHook\n\tlet context = hookState.context\n\n\tif (!context || !context.node) {\n\t\tthrow new Error(\n\t\t\t\"useTicker must be called from within a render function\"\n\t\t)\n\t}\n\n\tconst hook = createHook()\n\thook.state = prevHook ? prevHook.state : { now: -1, delta: -1 }\n\n\tconst onTick = (): EffectHookCallback | null => {\n\t\tlet now = Date.now()\n\t\tlet delta = -1\n\t\tif (prevHook && prevHook.state.lastTick > 0) {\n\t\t\tdelta = now - prevHook.state.lastTick\n\t\t}\n\t\thook.state = { lastTick: now, delta }\n\t\tcallback(now, delta)\n\t\treturn null\n\t}\n\thook.pendingTicks.push(onTick)\n\n\tcontext.node.hooks.push(hook)\n\tcontext.hookIndex++\n}\n","import { useReducer } from \"./useReducer\"\nimport { createHook } from \"../models\"\nimport { getHookState } from \"./getHookState\"\nimport { invokeOrReturn } from \"./invokeOrReturn\"\nimport type { Node } from \"../models\"\n\ntype RenderContextProperties = {\n    rootWidth: number\n    rootHeight: number\n    nodeRef: Node | null\n}\n\nexport function useRenderContext(): RenderContextProperties {\n    const { context } = getHookState()\n\n    let value: RenderContextProperties = {\n        rootWidth: 0,\n        rootHeight: 0,\n        nodeRef: null\n    }\n    if (context) {\n        value = {\n            rootWidth: context.size.width,\n            rootHeight: context.size.height,\n            nodeRef: context.node\n        }\n    }\n    return value\n}\n","import type { EffectHookCallback } from \"../models\"\nimport { createHook } from \"../models\"\nimport { getHookState } from \"./getHookState\"\nimport { haveArgsChanged } from \"./haveArgsChanged\"\n\nexport function useLayoutEffect(callback: EffectHookCallback, args: any[]) {\n    let hookState = getHookState()\n    let prevHook = hookState.prevHook\n    let context = hookState.context\n\n    if (!context || !context.node) {\n        throw new Error(\n            \"useLayoutEffect must be called from within a render function\"\n        )\n    }\n\n    let hook = createHook()\n    if (prevHook) {\n        hook.state = prevHook.state\n        hook.queue = prevHook.queue\n    }\n\n    if (haveArgsChanged(args, prevHook?.state)) {\n        hook.pendingLayout.push(callback)\n        hook.state = args\n    }\n    context.node.hooks.push(hook)\n    context.hookIndex++\n}\n","/** @jsxRuntime classic */\n/** @jsx createElement */\n/** @jsxFrag Fragment */\n\nimport { createElement, Fragment } from \"../render/\"\nimport { useRenderContext } from \"../hooks\"\n\ntype LayerProps = {\n    id: string\n}\n\nexport const Layer = (props: LayerProps, children: any) => {\n    const { rootWidth, rootHeight } = useRenderContext()\n    const attr = {\n        ...props,\n        width: rootWidth,\n        height: rootHeight\n    }\n    return <pklayer {...attr}>{children}</pklayer>\n}\n","/** @jsxRuntime classic */\n/** @jsx createElement */\n/** @jsxFrag Fragment */\n\nimport { createElement, Fragment } from \"../render/\"\n\ntype RectangleProps = {\n    x?: number | string\n    y?: number | string\n    width?: number | string\n    height?: number | string\n    fill?: string\n    stroke?: string\n    strokeWidth?: number\n    flex?: number | string\n}\n\nexport const Rectangle = (props: RectangleProps, children: any) => {\n    //console.log(\"Rectangle\", props, children)\n    if (children && children.length > 0) {\n        return <Fragment>{children}</Fragment>\n    } else {\n        return null\n    }\n}\n","/** @jsxRuntime classic */\n/** @jsx createElement */\n/** @jsxFrag Fragment */\n\nimport { createElement, Fragment } from \"../render/\"\n\ntype CircleProps = {\n    x?: number | string\n    y?: number | string\n    width?: number | string\n    height?: number | string\n    radius?: number | string\n    fill?: string\n    stroke?: string\n    strokeWidth?: number\n    flex?: number | string\n}\n\nexport const Circle = (props: CircleProps, children: any) => {\n    //console.log(\"Circle\", props, children)\n    if (children && children.length > 0) {\n        return <Fragment>{children}</Fragment>\n    } else {\n        return null\n    }\n}\n","/** @jsxRuntime classic */\n/** @jsx createElement */\n/** @jsxFrag Fragment */\n\nimport { createElement, Fragment } from \"../render/\"\n\ntype TextProps = {\n    x?: number\n    y?: number\n    width?: number\n    height?: number\n    fill?: string\n    stroke?: string\n    strokeWidth?: number\n    font?: string\n}\ntype TextAttr = {\n    text: string\n    x?: number\n    y?: number\n    width?: number\n    height?: number\n    fill?: string\n    stroke?: string\n    strokeWidth?: number\n    font?: string\n    _intrinsicWidth?: number\n    _intrinsicHeight?: number\n}\n\nconst fontCanvas = document.createElement(\"canvas\")\nconst fontCtx = fontCanvas.getContext(\"2d\")!\n\nexport const Text = (props: TextProps, children: any) => {\n    let attr: TextAttr = { ...props, text: \"\" }\n\n    // find intrinsic width and height\n    let text = \"\"\n    if (children && children.length > 0) {\n        text = children.join(\" \")\n    }\n    attr.text = text\n\n    // intrinsic width\n    if (props.font) {\n        fontCtx.textBaseline = \"top\"\n        fontCtx.font = props.font\n        let size = fontCtx.measureText(text || \"\")\n        if (size) {\n            attr._intrinsicWidth = size.width\n            attr._intrinsicHeight =\n                size.fontBoundingBoxDescent - size.fontBoundingBoxAscent\n        }\n    }\n\n    return <pktext {...attr} />\n}\n","import type { Node } from \"../models\"\n\nexport function translateFrame(node: Node, x: number, y: number): void {\n    if (node.frame) {\n        node.frame.x += x\n        node.frame.y += y\n    }\n    for (let child of node.children) {\n        translateFrame(child, x, y)\n    }\n}\n","/** @jsxRuntime classic */\n/** @jsx createElement */\n/** @jsxFrag Fragment */\nimport { mkRect, Node } from \"../models\"\nimport { createElement, Fragment } from \"../render/\"\nimport { useLayoutEffect, useRenderContext } from \"../hooks\"\nimport { translateFrame } from \"../render/translateFrame\"\n\nexport function Row(props: any, children: any) {\n    console.log(\"Row.props\", props)\n    console.log(\"Row.children\", children)\n\n    // let height = props.height ? parseFloat(props.height) : 0\n    let justifyContent = props.justifyContent ? props.justifyContent : \"start\"\n    let alignItems = props.alignItems ? props.alignItems : \"start\"\n\n    useLayoutEffect(() => {\n        const { nodeRef } = useRenderContext()\n        if (nodeRef) {\n            let x = nodeRef.frame!.x\n            let y = nodeRef.frame!.y\n            let width: number | null = null\n            if (props.width) {\n                width = nodeRef.frame!.width\n            }\n            let height: number | null = null\n            if (props.height) {\n                height = nodeRef.frame!.height\n            }\n            const refChildren = nodeRef.children[0].children\n\n            let childPadding = 0\n            let childWidth = 0\n            let childHeight = 0\n            let flexCount = 0\n            let flexibileWidth = width ? width : 0\n\n            // find flex count of children\n            for (let child of refChildren) {\n                if (child.props.flex) {\n                    try {\n                        let flexNum = parseInt(child.props.flex, 10)\n                        flexCount += flexNum\n                    } catch (e) {\n                        console.warn(e)\n                    }\n                } else if (child.frame) {\n                    flexibileWidth -= child.frame.width\n                }\n            }\n\n            // update child frames and calculate row width and height\n            for (let child of refChildren) {\n                console.log(\n                    \"Row.useLayoutEffect start\",\n                    child.name,\n                    child.frame\n                )\n                if (child.frame && child.props.flex && width) {\n                    try {\n                        let flexNum = parseInt(child.props.flex, 10)\n                        let flexRatio = flexNum / flexCount\n                        child.frame.width = flexRatio * flexibileWidth\n                        console.log(\n                            \"Row: flex width\",\n                            child.name,\n                            child.frame.width,\n                            flexRatio\n                        )\n                        childWidth += child.frame.width\n                    } catch (e) {\n                        console.warn(e)\n                    }\n                }\n                if (child.frame) {\n                    childWidth += child.frame.width\n                    childHeight = Math.max(childHeight, child.frame.height)\n                } else {\n                    console.warn(\"Row: child has no frame\", child)\n                }\n            }\n\n            // update the real col element frame width\n            if (width === null) {\n                width = childWidth\n                nodeRef.frame!.width = width\n            }\n            nodeRef.children[0].frame!.width = width\n\n            // update the real col element frame height\n            if (height === null) {\n                height = childHeight\n                nodeRef.frame!.height = height\n            }\n            nodeRef.children[0].frame!.height = height\n\n            // justify content\n            switch (justifyContent) {\n                case \"flex-start\":\n                case \"start\":\n                    // nothing to do\n                    break\n                case \"flex-end\":\n                case \"end\":\n                    x = x + width - childWidth\n                    break\n                case \"center\":\n                    x = x + (width - childWidth) / 2\n                    break\n                case \"space-between\":\n                    childPadding = (width - childWidth) / (children.length - 1)\n                    break\n                case \"space-around\":\n                    childPadding = (width - childWidth) / 2\n                    break\n                case \"space-evenly\":\n                    childPadding = (width - childWidth) / (children.length + 1)\n                    break\n            }\n\n            // align items\n            for (let child of refChildren) {\n                if (!child.frame) {\n                    child.frame = mkRect(0, 0, 0, 0)\n                    console.error(\"Row: child has no frame\", child)\n                }\n                let cy = y\n                let ch = child.frame.height\n                switch (alignItems) {\n                    case \"flex-start\":\n                    case \"start\":\n                        // nothing to do\n                        break\n                    case \"flex-end\":\n                    case \"end\":\n                        cy = y + height - child.frame.height\n                        break\n                    case \"center\":\n                    case \"baseline\":\n                        cy = y + (height - child.frame.height) / 2\n                        break\n                    case \"stretch\":\n                        ch = height\n                        // nothing to do\n                        break\n                }\n\n                translateFrame(child, x, cy)\n                child.frame.height = ch\n                console.log(\"Row.useLayoutEffect end\", child.name, child.frame)\n                x += child.frame.width\n                x += childPadding\n            }\n        }\n    }, [children, justifyContent, alignItems])\n\n    return <Fragment>{children}</Fragment>\n}\n\nfunction findBoxWidth(node: Node, depth = 0): number {\n    let width = 0\n    if (node.props) {\n        if (node.props.width) {\n            width = parseFloat(node.props.width)\n        } else if (node.props._intrinsicWidth) {\n            width = parseFloat(node.props._intrinsicWidth)\n        } else if (node.children) {\n            for (let child of node.children) {\n                let cw = findBoxWidth(child, depth + 1)\n                if (cw > width) {\n                    width = cw\n                }\n            }\n        }\n    } else {\n        console.error(\"findBoxWidth: node has no props\", node)\n    }\n    console.log(\"findBoxWidth\", node.name, width, node)\n    return width\n}\n","/** @jsxRuntime classic */\n/** @jsx createElement */\n/** @jsxFrag Fragment */\nimport { mkRect, Node } from \"../models\"\nimport { createElement, Fragment } from \"../render/\"\nimport { useLayoutEffect, useRenderContext } from \"../hooks\"\nimport { translateFrame } from \"../render/translateFrame\"\n\nexport function Column(props: any, children: any) {\n    console.log(\"Column.props\", props)\n    console.log(\"Column.children\", children)\n\n    // let height = props.height ? parseFloat(props.height) : 0\n    let justifyContent = props.justifyContent ? props.justifyContent : \"start\"\n    let alignItems = props.alignItems ? props.alignItems : \"start\"\n\n    useLayoutEffect(() => {\n        const { nodeRef } = useRenderContext()\n        if (nodeRef) {\n            let x = nodeRef.frame!.x\n            let y = nodeRef.frame!.y\n            let width: number | null = null\n            if (props.width) {\n                width = nodeRef.frame!.width\n            }\n            let height: number | null = null\n            if (props.height) {\n                height = nodeRef.frame!.height\n            }\n            const refChildren = nodeRef.children[0].children\n\n            let childPadding = 0\n            let childWidth = 0\n            let childHeight = 0\n            let flexCount = 0\n            let flexibleHight = height ? height : 0\n\n            // find flex count of children\n            for (let child of refChildren) {\n                if (child.props.flex) {\n                    try {\n                        let flexNum = parseInt(child.props.flex, 10)\n                        flexCount += flexNum\n                    } catch (e) {\n                        console.warn(e)\n                    }\n                } else if (child.frame) {\n                    flexibleHight -= child.frame.height\n                }\n            }\n\n            // update child frames and calculate column height and width\n            for (let child of refChildren) {\n                console.log(\n                    \"Column.useLayoutEffect start\",\n                    child.name,\n                    child.frame\n                )\n                if (child.frame && child.props.flex && height) {\n                    try {\n                        let flexNum = parseInt(child.props.flex, 10)\n                        let flexRatio = flexNum / flexCount\n                        child.frame.height = flexRatio * flexibleHight\n                        console.log(\n                            \"Column: flex height\",\n                            child.name,\n                            child.frame.height,\n                            flexRatio\n                        )\n                        childHeight += child.frame.height\n                        childWidth = Math.max(childWidth, child.frame.width)\n                    } catch (e) {\n                        console.warn(e)\n                    }\n                } else if (child.frame) {\n                    childHeight += child.frame.height\n                    childWidth = Math.max(childWidth, child.frame.width)\n                } else {\n                    console.error(\"Column: child has no frame\", child)\n                }\n            }\n\n            // update the real col element frame width\n            if (width === null) {\n                width = childWidth\n                nodeRef.frame!.width = width\n            }\n            nodeRef.children[0].frame!.width = width\n\n            // update the real col element frame height\n            if (height === null) {\n                height = childHeight\n                nodeRef.frame!.height = height\n            }\n            nodeRef.children[0].frame!.height = height\n\n            // justify content\n            switch (justifyContent) {\n                case \"flex-start\":\n                case \"start\":\n                    // nothing to do\n                    break\n                case \"flex-end\":\n                case \"end\":\n                    y = y + height - childHeight\n                    break\n                case \"center\":\n                    y = y + (height - childHeight) / 2\n                    break\n                case \"space-between\":\n                    childPadding =\n                        (height - childHeight) / (children.length - 1)\n                    break\n                case \"space-around\":\n                    childPadding = (height - childHeight) / 2\n                    break\n                case \"space-evenly\":\n                    childPadding =\n                        (height - childHeight) / (children.length + 1)\n                    break\n            }\n\n            // align items\n            for (let child of refChildren) {\n                if (!child.frame) {\n                    child.frame = mkRect(0, 0, 0, 0)\n                    console.error(\"Column: child has no frame\", child)\n                }\n                let cx = x\n                let cw = child.frame.width\n                switch (alignItems) {\n                    case \"flex-start\":\n                    case \"start\":\n                        // nothing to do\n                        break\n                    case \"flex-end\":\n                    case \"end\":\n                        cx = x + width - child.frame.width\n                        break\n                    case \"center\":\n                    case \"baseline\":\n                        cx = x + (width - child.frame.width) / 2\n                        break\n                    case \"stretch\":\n                        cw = width\n                        // nothing to do\n                        break\n                }\n\n                translateFrame(child, cx, y)\n                child.frame.width = cw\n                console.log(\n                    \"Column.useLayoutEffect end\",\n                    child.name,\n                    child.frame\n                )\n                y += child.frame.height\n                y += childPadding\n            }\n        }\n    }, [children, justifyContent, alignItems])\n\n    return <Fragment>{children}</Fragment>\n}\n\nfunction findBoxWidth(node: Node, depth = 0): number {\n    let width = 0\n    if (node.props) {\n        if (node.props.width) {\n            width = parseFloat(node.props.width)\n        } else if (node.props._intrinsicWidth) {\n            width = parseFloat(node.props._intrinsicWidth)\n        } else if (node.children) {\n            for (let child of node.children) {\n                let cw = findBoxWidth(child, depth + 1)\n                if (cw > width) {\n                    width = cw\n                }\n            }\n        }\n    } else {\n        console.error(\"findBoxWidth: node has no props\", node)\n    }\n    console.log(\"findBoxWidth\", node.name, width, node)\n    return width\n}\n","/** @jsxRuntime classic */\n/** @jsx createElement */\n/** @jsxFrag Fragment */\n\nimport { createElement, Fragment } from \"../render/\"\n\ntype PolygonProps = {\n    x?: number | string\n    y?: number | string\n    width?: number | string\n    height?: number | string\n    radius?: number | string\n    sides?: number | string\n    fill?: string\n    stroke?: string\n    strokeWidth?: number\n    flex?: number | string\n}\n\nexport const Polygon = (props: PolygonProps, children: any) => {\n    //console.log(\"Polygon\", props, children)\n    if (children && children.length > 0) {\n        return <Fragment>{children}</Fragment>\n    } else {\n        return null\n    }\n}\n","/** @jsxRuntime classic */\n/** @jsx createElement */\n/** @jsxFrag Fragment */\nimport { Points } from \"../models\"\n\nimport { createElement, Fragment } from \"../render\"\n\ntype PathProps = {\n    x?: number | string\n    y?: number | string\n    width?: number | string\n    height?: number | string\n    closed?: boolean | string\n    path?: Points\n    fill?: string\n    stroke?: string\n    strokeWidth?: number\n    flex?: number | string\n}\n\nexport const Path = (props: PathProps, children: any) => {\n    //console.log(\"Path\", props, children)\n    if (children && children.length > 0) {\n        return <Fragment>{children}</Fragment>\n    } else {\n        return null\n    }\n}\n","/** @jsxRuntime classic */\n/** @jsx createElement */\n/** @jsxFrag Fragment */\n\nimport { createElement, Fragment } from \"../render\"\n\ntype GroupProps = {\n    x?: number | string\n    y?: number | string\n    width?: number | string\n    height?: number | string\n    flex?: number | string\n}\n\nexport const Group = (props: GroupProps, children: any) => {\n    //console.log(\"Path\", props, children)\n    if (children && children.length > 0) {\n        return <Fragment>{children}</Fragment>\n    } else {\n        return null\n    }\n}\n"],"names":["Fragment","createElement","type","props","children","name","console","log","alternate","hooks","needsDraw","cache","frame","createHook","state","queue","pendingEffects","pendingTicks","pendingUnmount","pendingLayout","mkPoint","x","y","pointLerp","a","b","t","pointAt","p","angle","distance","Math","cos","sin","mkRect","width","height","rectLeft","rect","rectRight","rectTop","rectBottom","rectCenter","rectContains","point","rectIntersects","mkSize","flattenChildren","nodes","Array","isArray","child","concat","push","havePropsChanged","ignoreKeys","key","indexOf","length","i","minifyNode","node","mini","pruneGrandChildren","map","grandChild","paintContext","canvas","canvasStack","PaintJob","constructor","doPainting","paint","val","paintingContext","pushCanvas","popCanvas","c","pop","updateRenderingContextFromProps","ctx","hasChanged","shouldFill","shouldStroke","fill","stroke","strokeWidth","font","ctxKey","getCanvas","id","sup","getSharedSupervisor","canvases","find","canvasId","LayerJob","tmpCanvas","document","tmpContext","getContext","clearRect","LayerEndJob","origContext","drawImage","RectangleJob","frm","cu","save","beginPath","fillRect","strokeRect","restore","TextJob","text","tm","measureText","actualBoundingBoxAscent","fillText","strokeText","CircleJob","radius","ellipse","PI","PathJob","closePath","closed","path","pt","moveTo","lineTo","PolygonJob","sides","parseFloat","center","FrameJob","FrameEndJob","groupId","GroupJob","GroupEndJob","buildPaintJobs","jobs","paintLoop","job","shift","StateManager","step","bind","AUTO_LOOP","onKeyUp","e","requestRootUpdate","deadline","performance","now","timeRemaining","didTimeout","addEventListener","root","_root","_node","setRoot","fn","size","unitsOfWork","start","isRunning","window","requestIdleCallback","stepCallbackId","setTimeout","stop","cancelIdleCallback","currentRoot","workTimerHooks","hasUpdateBeenRequested","startRootUpdate","performNextUnitOfWork","resolveIntrinsicFrames","resolveCalculatedFrames","workLayoutHooks","commitRoot","workEffectHooks","diff","n","next","updateNode","propigateNeedsDraw","paintCount","debugFrames","parent","w","r","includes","wp","rp","h","hp","xp","xPos","yp","yPos","resolveWidth","resolveHeight","_intrinsicWidth","max","_intrinsicHeight","depth","indent","padEnd","_nodeFrame","hook","action","includeChildren","unmount","cb","prevChildren","Function","hookIndex","f","nextChildren","childDiff","diffChildren","inherited","removed","prev","nextNode","diffNode","sameType","error","Supervisor","stateManager","addLayer","layer","currentContext","activeLayer","sharedSupervisor","PinkKoala","containerRef","useRef","useEffect","current","canvasNodes","querySelectorAll","from","drawing","React","ref","className","layers","haveArgsChanged","invokeOrReturn","arg","getHookState","context","prevHook","callback","args","hookState","Error","useEventListener","event","handler","removeEventListener","useReducer","reducer","initialState","init","undefined","actions","dispatch","useState","useTicker","delta","onTick","Date","lastTick","useRenderContext","value","rootWidth","rootHeight","nodeRef","useLayoutEffect","Layer","attr","Rectangle","Circle","fontCanvas","fontCtx","Text","join","textBaseline","fontBoundingBoxDescent","fontBoundingBoxAscent","translateFrame","Row","justifyContent","alignItems","refChildren","childPadding","childWidth","childHeight","flexCount","flexibileWidth","flex","flexNum","parseInt","warn","flexRatio","cy","ch","Column","flexibleHight","cx","cw","Polygon","Path","Group"],"mappings":";;IAGWA,QAAQ,GAAG;SAgBNC,cACZC,MACAC,OACA,GAAGC;AAEH,MAAIC,IAAI,GAAW,EAAnB;;AACA,MAAI,OAAOH,IAAP,KAAgB,QAApB,EAA8B;AAC1BG,IAAAA,IAAI,GAAGH,IAAP;AACH,GAFD,MAEO,IAAI,OAAOA,IAAP,KAAgB,UAApB,EAAgC;AACnCG,IAAAA,IAAI,GAAGH,IAAI,CAACG,IAAZ;AACH;;AAqBDC,EAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA6BF,IAA7B,EAAmCF,KAAnC,EAA0CC,QAA1C;AAEA,SAAO;AACHF,IAAAA,IADG;AAEHG,IAAAA,IAFG;AAGHF,IAAAA,KAAK,EAAE,EACH,GAAGA;AADA,KAHJ;AAMHC,IAAAA,QAAQ,EAAEA,QANP;AAOHI,IAAAA,SAAS,EAAE,IAPR;AAQHC,IAAAA,KAAK,EAAE,EARJ;AASHC,IAAAA,SAAS,EAAE,KATR;AAUHC,IAAAA,KAAK,EAAE,IAVJ;AAWHC,IAAAA,KAAK,EAAE;AAXJ,GAAP;AAaH;;SCnDeC;AACZ,SAAO;AACHC,IAAAA,KAAK,EAAE,EADJ;AAEHC,IAAAA,KAAK,EAAE,EAFJ;AAGHC,IAAAA,cAAc,EAAE,EAHb;AAIHC,IAAAA,YAAY,EAAE,EAJX;AAKHC,IAAAA,cAAc,EAAE,EALb;AAMHC,IAAAA,aAAa,EAAE;AANZ,GAAP;AAQH;;SClBeC,QAAQC,GAAWC;AAClC,SAAO;AAAED,IAAAA,CAAF;AAAKC,IAAAA;AAAL,GAAP;AACA;AAED,SAAgBC,UAAUC,GAAUC,GAAUC;AAC7C,SAAON,OAAO,CAACI,CAAC,CAACH,CAAF,GAAM,CAACI,CAAC,CAACJ,CAAF,GAAMG,CAAC,CAACH,CAAT,IAAcK,CAArB,EAAwBF,CAAC,CAACF,CAAF,GAAM,CAACG,CAAC,CAACH,CAAF,GAAME,CAAC,CAACF,CAAT,IAAcI,CAA5C,CAAd;AACA;AAED,SAAgBC,QAAQC,GAAUC,OAAeC;AAChD,SAAOP,SAAS,CACfK,CADe,EAEfR,OAAO,CACNQ,CAAC,CAACP,CAAF,GAAMU,IAAI,CAACC,GAAL,CAASH,KAAT,IAAkBC,QADlB,EAENF,CAAC,CAACN,CAAF,GAAMS,IAAI,CAACE,GAAL,CAASJ,KAAT,IAAkBC,QAFlB,CAFQ,EAMf,CANe,CAAhB;AAQA;;SCZeI,OACZb,GACAC,GACAa,OACAC;AAEA,SAAO;AAAEf,IAAAA,CAAF;AAAKC,IAAAA,CAAL;AAAQa,IAAAA,KAAR;AAAeC,IAAAA;AAAf,GAAP;AACH;AAED,SAAgBC,SAASC;AACrB,SAAOA,IAAI,CAACjB,CAAZ;AACH;AAED,SAAgBkB,UAAUD;AACtB,SAAOA,IAAI,CAACjB,CAAL,GAASiB,IAAI,CAACH,KAArB;AACH;AAED,SAAgBK,QAAQF;AACpB,SAAOA,IAAI,CAAChB,CAAZ;AACH;AAED,SAAgBmB,WAAWH;AACvB,SAAOA,IAAI,CAAChB,CAAL,GAASgB,IAAI,CAACF,MAArB;AACH;AAED,SAAgBM,WAAWJ;AACvB,SAAOlB,OAAO,CAACkB,IAAI,CAACjB,CAAL,GAASiB,IAAI,CAACH,KAAL,GAAa,CAAvB,EAA0BG,IAAI,CAAChB,CAAL,GAASgB,IAAI,CAACF,MAAL,GAAc,CAAjD,CAAd;AACH;AAED,SAAgBO,aAAaL,MAAYM;AACrC,SACIA,KAAK,CAACvB,CAAN,IAAWgB,QAAQ,CAACC,IAAD,CAAnB,IACAM,KAAK,CAACvB,CAAN,IAAWkB,SAAS,CAACD,IAAD,CADpB,IAEAM,KAAK,CAACtB,CAAN,IAAWkB,OAAO,CAACF,IAAD,CAFlB,IAGAM,KAAK,CAACtB,CAAN,IAAWmB,UAAU,CAACH,IAAD,CAJzB;AAMH;AAED,SAAgBO,eAAerB,GAASC;AACpC,SACIY,QAAQ,CAACb,CAAD,CAAR,IAAee,SAAS,CAACd,CAAD,CAAxB,IACAc,SAAS,CAACf,CAAD,CAAT,IAAgBa,QAAQ,CAACZ,CAAD,CADxB,IAEAe,OAAO,CAAChB,CAAD,CAAP,IAAciB,UAAU,CAAChB,CAAD,CAFxB,IAGAgB,UAAU,CAACjB,CAAD,CAAV,IAAiBgB,OAAO,CAACf,CAAD,CAJ5B;AAMH;;MClDYqB,MAAM,GAAG,CAACX,KAAD,EAAgBC,MAAhB,MAA0C;AAC/DD,EAAAA,KAD+D;AAE/DC,EAAAA;AAF+D,CAA1C,CAAf;;SCLSW,gBAAmB3C;AAC/B,MAAI4C,KAAK,GAAU,EAAnB;;AACA,MAAIC,KAAK,CAACC,OAAN,CAAc9C,QAAd,CAAJ,EAA6B;AACzB,SAAK,IAAI+C,KAAT,IAAkB/C,QAAlB,EAA4B;AACxB,UAAI6C,KAAK,CAACC,OAAN,CAAcC,KAAd,CAAJ,EAA0B;AACtBH,QAAAA,KAAK,GAAGA,KAAK,CAACI,MAAN,CAAaL,eAAe,CAACI,KAAD,CAA5B,CAAR;AACH,OAFD,MAEO,IAAIA,KAAJ,EAAW;AACdH,QAAAA,KAAK,CAACK,IAAN,CAAWF,KAAX;AACH;AACJ;AACJ;;AACD,SAAOH,KAAP;AACH;;SCVeM,iBACf9B,GACAC;AAEA,QAAM8B,UAAU,GAAG,CAAC,UAAD,EAAa,QAAb,CAAnB;;AACA,MAAI/B,CAAC,KAAK,IAAN,IAAcC,CAAC,KAAK,IAAxB,EAA8B;AAC7B,WAAO,IAAP;AACA;;AACD,OAAK,IAAI+B,GAAT,IAAgBhC,CAAhB,EAAmB;AAClB,QAAI+B,UAAU,CAACE,OAAX,CAAmBD,GAAnB,MAA4B,CAAC,CAAjC,EAAoC;AACnC,UAAIP,KAAK,CAACC,OAAN,CAAc1B,CAAC,CAACgC,GAAD,CAAf,CAAJ,EAA2B;AAC1B,YAAIhC,CAAC,CAACgC,GAAD,CAAD,CAAOE,MAAP,KAAkBjC,CAAC,CAAC+B,GAAD,CAAD,CAAOE,MAA7B,EAAqC;AACpC,iBAAO,IAAP;AACA;;AACD,aAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnC,CAAC,CAACgC,GAAD,CAAD,CAAOE,MAA3B,EAAmCC,CAAC,EAApC,EAAwC;AACvC,cAAIL,gBAAgB,CAAC9B,CAAC,CAACgC,GAAD,CAAD,CAAOG,CAAP,CAAD,EAAYlC,CAAC,CAAC+B,GAAD,CAAD,CAAOG,CAAP,CAAZ,CAApB,EAA4C;AAC3C,mBAAO,IAAP;AACA;AACD;AACD,OATD,MASO,IAAI,OAAOnC,CAAC,CAACgC,GAAD,CAAR,KAAkB,QAAtB,EAAgC;AACtC,YAAIF,gBAAgB,CAAC9B,CAAC,CAACgC,GAAD,CAAF,EAAS/B,CAAC,CAAC+B,GAAD,CAAV,CAApB,EAAsC;AACrC,iBAAO,IAAP;AACA;AACD,OAJM,MAIA,IAAIhC,CAAC,CAACgC,GAAD,CAAD,KAAW/B,CAAC,CAAC+B,GAAD,CAAhB,EAAuB;AAC7B,eAAO,IAAP;AACA;AACD;AACD;;AAED,SAAO,KAAP;AACA;;SC9BeI,WAAWC;AACvB,MAAIC,IAAI,GAAG;AACPzD,IAAAA,IAAI,EAAEwD,IAAI,CAACxD,IADJ;AAEPH,IAAAA,IAAI,EAAE2D,IAAI,CAAC3D,IAFJ;AAGPC,IAAAA,KAAK,EAAE0D,IAAI,CAAC1D,KAHL;AAIPC,IAAAA,QAAQ,EAAEyD,IAAI,CAACzD,QAJR;AAKPI,IAAAA,SAAS,EAAE,IALJ;AAMPC,IAAAA,KAAK,EAAEoD,IAAI,CAACpD,KANL;AAOPC,IAAAA,SAAS,EAAE,KAPJ;AAQPC,IAAAA,KAAK,EAAEkD,IAAI,CAAClD,KARL;AASPC,IAAAA,KAAK,EAAEiD,IAAI,CAACjD;AATL,GAAX;AAWA,SAAOmD,kBAAkB,CAACD,IAAD,CAAzB;AACH;AAED,SAAgBC,mBAAmBF;AAC/B,MAAIzD,QAAQ,GAAGyD,IAAI,CAACzD,QAAL,CAAc4D,GAAd,CAAmBb,KAAD;AAC7B,QAAIW,IAAI,GAAGF,UAAU,CAACT,KAAD,CAArB;;AACA,QAAIW,IAAI,CAAC1D,QAAL,CAAcsD,MAAd,GAAuB,CAA3B,EAA8B;AAC1BI,MAAAA,IAAI,CAAC1D,QAAL,GAAgB0D,IAAI,CAAC1D,QAAL,CAAc4D,GAAd,CAAmBC,UAAD;AAC9B,eAAOL,UAAU,CAACK,UAAD,CAAjB;AACH,OAFe,CAAhB;AAGH;;AACD,WAAOH,IAAP;AACH,GARc,CAAf;AASAD,EAAAA,IAAI,CAACzD,QAAL,GAAgBA,QAAhB;AACA,SAAOyD,IAAP;AACH;;ACrBD,IAAIK,YAAY,GAAiB;AAChCC,EAAAA,MAAM,EAAE,IADwB;AAEhCC,EAAAA,WAAW,EAAE;AAFmB,CAAjC;AAKA,MAAaC;AAKZC,EAAAA,YAAYT;AACX,SAAKxD,IAAL,GAAY,UAAZ;AACA,SAAKwD,IAAL,GAAYA,IAAZ;AACA;;AAEMU,EAAAA,UAAU;AAChB,SAAKC,KAAL;AACA;;AAEMA,EAAAA,KAAK;;AAEK,MAANL,MAAM;AAChB,WAAOD,YAAY,CAACC,MAApB;AACA;;AAEgB,MAANA,MAAM,CAACM,GAAD;AAChBP,IAAAA,YAAY,CAACC,MAAb,GAAsBM,GAAtB;AACA;;AAEyB,MAAfC,eAAe;AACzB,WAAOR,YAAP;AACA;;AAEMS,EAAAA,UAAU,CAACR,MAAD;AAChBD,IAAAA,YAAY,CAACE,WAAb,CAAyBf,IAAzB,CAA8Bc,MAA9B;AACA;;AAEMS,EAAAA,SAAS;AACf,QAAIC,CAAC,GAAGX,YAAY,CAACE,WAAb,CAAyBU,GAAzB,EAAR;;AACA,QAAID,CAAJ,EAAO;AACN,aAAOA,CAAP;AACA,KAFD,MAEO;AACN,aAAO,IAAP;AACA;AACD;;AAEME,EAAAA,+BAA+B,CACrCC,GADqC,EAErC7E,KAFqC;AAIrC,QAAI8E,UAAU,GAAG,KAAjB;AACA,QAAIC,UAAU,GAAG,KAAjB;AACA,QAAIC,YAAY,GAAG,KAAnB;AAEA,UAAMnB,GAAG,GAAwB;AAChCoB,MAAAA,IAAI,EAAE,WAD0B;AAEhCC,MAAAA,MAAM,EAAE,aAFwB;AAGhCC,MAAAA,WAAW,EAAE,WAHmB;AAIhCC,MAAAA,IAAI,EAAE;AAJ0B,KAAjC;;AAOA,SAAK,IAAI/B,GAAT,IAAgBQ,GAAhB,EAAqB;AACpB,UAAIwB,MAAM,GAAGxB,GAAG,CAACR,GAAD,CAAhB;;AACA,UAAIrD,KAAK,CAACqD,GAAD,CAAL,IAAcwB,GAAG,CAACQ,MAAD,CAAH,KAAgBrF,KAAK,CAACqD,GAAD,CAAvC,EAA8C;AAC7CwB,QAAAA,GAAG,CAACQ,MAAD,CAAH,GAAcrF,KAAK,CAACqD,GAAD,CAAnB;AACAyB,QAAAA,UAAU,GAAG,IAAb;AACA;;AACD,UAAIzB,GAAG,KAAK,MAAR,IAAkBrD,KAAK,CAACqD,GAAD,CAA3B,EAAkC;AACjC0B,QAAAA,UAAU,GAAG,IAAb;AACA;;AACD,UAAI1B,GAAG,KAAK,QAAR,IAAoBrD,KAAK,CAACqD,GAAD,CAA7B,EAAoC;AACnC2B,QAAAA,YAAY,GAAG,IAAf;AACA;AACD;;AAED,WAAO;AACNF,MAAAA,UADM;AAENC,MAAAA,UAFM;AAGNC,MAAAA;AAHM,KAAP;AAKA;;;;SCtFcM,UAAUC;AACtB,MAAIC,GAAG,GAAGC,mBAAmB,EAA7B;AACA,QAAMC,QAAQ,GAAGF,GAAG,CAACE,QAArB;AACA,QAAM1B,MAAM,GAAG0B,QAAQ,CAACC,IAAT,CAAejB,CAAD,IAAOA,CAAC,CAACa,EAAF,KAASA,EAA9B,CAAf;AACA,SAAOvB,MAAP;AACH;;ACJD,IAAI4B,QAAQ,GAAG,CAAf;AAEA,MAAaC,iBAAiB3B;AAC7BC,EAAAA,YAAYT;AACX,UAAMA,IAAN;AACA,SAAKxD,IAAL,GAAY,UAAZ;AACA;;AAEMmE,EAAAA,KAAK;AACX,QAAIL,MAAM,GAAGsB,SAAS,CAAC,KAAK5B,IAAL,CAAU1D,KAAV,CAAgBuF,EAAjB,CAAtB;;AACA,QAAIvB,MAAJ,EAAY;AACX,UAAI8B,SAAS,GAAG,KAAKpC,IAAL,CAAUlD,KAA1B;;AACA,UAAI,CAACsF,SAAL,EAAgB;AACfA,QAAAA,SAAS,GAAGC,QAAQ,CAACjG,aAAT,CAAuB,QAAvB,CAAZ;AACAgG,QAAAA,SAAS,CAACP,EAAV,uBAAmCK,QAAQ,IAA3C;AACAE,QAAAA,SAAS,CAAC7D,MAAV,GAAmB+B,MAAM,CAAC/B,MAA1B;AACA6D,QAAAA,SAAS,CAAC9D,KAAV,GAAkBgC,MAAM,CAAChC,KAAzB;AACA,aAAK0B,IAAL,CAAUlD,KAAV,GAAkBsF,SAAlB;AACA;;AACD,UAAIE,UAAU,GAAGF,SAAS,CAACG,UAAV,CAAqB,IAArB,CAAjB;;AACA,UAAID,UAAJ,EAAgB;AACfA,QAAAA,UAAU,CAACE,SAAX,CAAqB,CAArB,EAAwB,CAAxB,EAA2BJ,SAAS,CAAC9D,KAArC,EAA4C8D,SAAS,CAAC7D,MAAtD;AACA,aAAK+B,MAAL,GAAc8B,SAAd;AACA;AACD;AACD;;;;MCxBWK,oBAAoBjC;AAChCC,EAAAA,YAAYT;AACX,UAAMA,IAAN;AACA,SAAKxD,IAAL,GAAY,aAAZ;AACA;;AAEMmE,EAAAA,KAAK;AACX,QAAIL,MAAM,GAAGsB,SAAS,CAAC,KAAK5B,IAAL,CAAU1D,KAAV,CAAgBuF,EAAjB,CAAtB;;AACA,QAAIvB,MAAJ,EAAY;AACX,UAAIoC,WAAW,GAAGpC,MAAM,CAACiC,UAAP,CAAkB,IAAlB,CAAlB;AACAG,MAAAA,WAAW,CAACF,SAAZ,CAAsB,CAAtB,EAAyB,CAAzB,EAA4BlC,MAAM,CAAChC,KAAnC,EAA0CgC,MAAM,CAAC/B,MAAjD;AACAmE,MAAAA,WAAW,CAACC,SAAZ,CAAsB,KAAK3C,IAAL,CAAUlD,KAAhC,EAAuC,CAAvC,EAA0C,CAA1C;AAGA,WAAKwD,MAAL,GAAcA,MAAd;AACA;AACD;;;;MCjBWsC,qBAAqBpC;AAC9BC,EAAAA,YAAYT;AACR,UAAMA,IAAN;AACA,SAAKxD,IAAL,GAAY,cAAZ;AACH;;AAEMmE,EAAAA,KAAK;AAER,QAAIkC,GAAG,GAAG,KAAK7C,IAAL,CAAUjD,KAApB;;AAGA,QAAI,KAAKuD,MAAT,EAAiB;AACb,UAAIa,GAAG,GAAG,KAAKb,MAAL,CAAYiC,UAAZ,CAAuB,IAAvB,CAAV;AACA,UAAIO,EAAE,GAAG,KAAK5B,+BAAL,CAAqCC,GAArC,EAA0C,KAAKnB,IAAL,CAAU1D,KAApD,CAAT;;AACA,UAAIwG,EAAE,CAAC1B,UAAP,EAAmB;AACfD,QAAAA,GAAG,CAAC4B,IAAJ;AACH;;AAED5B,MAAAA,GAAG,CAAC6B,SAAJ;;AAGA,UAAIF,EAAE,CAACzB,UAAP,EAAmB;AACf5E,QAAAA,OAAO,CAACC,GAAR,CACI,yBADJ,EAEImG,GAAG,CAACrF,CAFR,EAGIqF,GAAG,CAACpF,CAHR,EAIIoF,GAAG,CAACvE,KAJR,EAKIuE,GAAG,CAACtE,MALR;AAOA4C,QAAAA,GAAG,CAAC8B,QAAJ,CAAaJ,GAAG,CAACrF,CAAjB,EAAoBqF,GAAG,CAACpF,CAAxB,EAA2BoF,GAAG,CAACvE,KAA/B,EAAsCuE,GAAG,CAACtE,MAA1C;AACH;;AAGD,UAAIuE,EAAE,CAACxB,YAAP,EAAqB;AACjBH,QAAAA,GAAG,CAAC+B,UAAJ,CAAeL,GAAG,CAACrF,CAAnB,EAAsBqF,GAAG,CAACpF,CAA1B,EAA6BoF,GAAG,CAACvE,KAAjC,EAAwCuE,GAAG,CAACtE,MAA5C;AACH;;AAED,UAAIuE,EAAE,CAAC1B,UAAP,EAAmB;AACfD,QAAAA,GAAG,CAACgC,OAAJ;AACH;AACJ;AACJ;;;;MCzCQC,gBAAgB5C;AACzBC,EAAAA,YAAYT;AACR,UAAMA,IAAN;AACA,SAAKxD,IAAL,GAAY,SAAZ;AACH;;AAEMmE,EAAAA,KAAK;AAER,QAAInD,CAAC,GAAG,KAAKwC,IAAL,CAAUjD,KAAV,CAAiBS,CAAzB;AACA,QAAIC,CAAC,GAAG,KAAKuC,IAAL,CAAUjD,KAAV,CAAiBU,CAAzB;AACA,QAAI4F,IAAI,GAAI,KAAKrD,IAAL,CAAU1D,KAAV,CAAgB+G,IAAhB,IAAmC,EAA/C;;AAGA,QAAI,KAAK/C,MAAT,EAAiB;AACb,UAAIa,GAAG,GAAG,KAAKb,MAAL,CAAYiC,UAAZ,CAAuB,IAAvB,CAAV;AACA,UAAIO,EAAE,GAAG,KAAK5B,+BAAL,CAAqCC,GAArC,EAA0C,KAAKnB,IAAL,CAAU1D,KAApD,CAAT;;AACA,UAAIwG,EAAE,CAAC1B,UAAP,EAAmB;AACfD,QAAAA,GAAG,CAAC4B,IAAJ;AACH;;AAED5B,MAAAA,GAAG,CAAC6B,SAAJ;AACA,UAAIM,EAAE,GAAGnC,GAAG,CAACoC,WAAJ,CAAgBF,IAAhB,CAAT;AACA5F,MAAAA,CAAC,GAAGA,CAAC,GAAG6F,EAAE,CAACE,uBAAX;;AAGA,UAAIV,EAAE,CAACzB,UAAP,EAAmB;AACfF,QAAAA,GAAG,CAACsC,QAAJ,CAAaJ,IAAb,EAAmB7F,CAAnB,EAAsBC,CAAtB;AACH;;AAGD,UAAIqF,EAAE,CAACxB,YAAP,EAAqB;AACjBH,QAAAA,GAAG,CAACuC,UAAJ,CAAeL,IAAf,EAAqB7F,CAArB,EAAwBC,CAAxB;AACH;;AAED,UAAIqF,EAAE,CAAC1B,UAAP,EAAmB;AACfD,QAAAA,GAAG,CAACgC,OAAJ;AACH;AACJ;AACJ;;;;MCtCQQ,kBAAkBnD;AAC3BC,EAAAA,YAAYT;AACR,UAAMA,IAAN;AACA,SAAKxD,IAAL,GAAY,WAAZ;AACH;;AAEMmE,EAAAA,KAAK;AACR,QAAIkC,GAAG,GAAG,KAAK7C,IAAL,CAAUjD,KAApB;AAGA,QAAI6G,MAAM,GAAGf,GAAG,CAACvE,KAAJ,GAAY,CAAzB;;AAGA,QAAI,KAAKgC,MAAT,EAAiB;AACb,UAAIa,GAAG,GAAG,KAAKb,MAAL,CAAYiC,UAAZ,CAAuB,IAAvB,CAAV;AACA,UAAIO,EAAE,GAAG,KAAK5B,+BAAL,CAAqCC,GAArC,EAA0C,KAAKnB,IAAL,CAAU1D,KAApD,CAAT;;AACA,UAAIwG,EAAE,CAAC1B,UAAP,EAAmB;AACfD,QAAAA,GAAG,CAAC4B,IAAJ;AACH;;AAGD5B,MAAAA,GAAG,CAAC6B,SAAJ;AACA7B,MAAAA,GAAG,CAAC0C,OAAJ,CACIhB,GAAG,CAACrF,CAAJ,GAAQoG,MADZ,EAEIf,GAAG,CAACpF,CAAJ,GAAQmG,MAFZ,EAGIA,MAHJ,EAIIA,MAJJ,EAKI,CALJ,EAMI,CANJ,EAOI,IAAI1F,IAAI,CAAC4F,EAPb;;AAWA,UAAIhB,EAAE,CAACzB,UAAP,EAAmB;AACfF,QAAAA,GAAG,CAACI,IAAJ;AACH;;AAGD,UAAIuB,EAAE,CAACxB,YAAP,EAAqB;AACjBH,QAAAA,GAAG,CAACK,MAAJ;AACH;;AAED,UAAIsB,EAAE,CAAC1B,UAAP,EAAmB;AACfD,QAAAA,GAAG,CAACgC,OAAJ;AACH;AACJ;AACJ;;;;MC9CQY,gBAAgBvD;AACzBC,EAAAA,YAAYT;AACR,UAAMA,IAAN;AACA,SAAKxD,IAAL,GAAY,SAAZ;AACH;;AAEMmE,EAAAA,KAAK;AACR,QAAIkC,GAAG,GAAG,KAAK7C,IAAL,CAAUjD,KAApB;AAGA,QAAIiH,SAAS,GAAG,KAAKhE,IAAL,CAAU1D,KAAV,CAAgB2H,MAAhB,GAAyB,KAAKjE,IAAL,CAAU1D,KAAV,CAAgB2H,MAAzC,GAAkD,KAAlE;AACA,QAAIC,IAAI,GAAY,KAAKlE,IAAL,CAAU1D,KAAV,CAAgB4H,IAAhB,IAAmC,EAAvD;;AAGA,QAAI,KAAK5D,MAAT,EAAiB;AACb,UAAIa,GAAG,GAAG,KAAKb,MAAL,CAAYiC,UAAZ,CAAuB,IAAvB,CAAV;AACA,UAAIO,EAAE,GAAG,KAAK5B,+BAAL,CAAqCC,GAArC,EAA0C,KAAKnB,IAAL,CAAU1D,KAApD,CAAT;;AAGA,UAAIwG,EAAE,CAAC1B,UAAP,EAAmB;AACfD,QAAAA,GAAG,CAAC4B,IAAJ;AACH;;AAGD5B,MAAAA,GAAG,CAAC6B,SAAJ;AACA,UAAIlD,CAAC,GAAG,CAAR;;AACA,WAAK,IAAIqE,EAAT,IAAeD,IAAf,EAAqB;AACjB,YAAIpE,CAAC,KAAK,CAAV,EAAa;AACTqB,UAAAA,GAAG,CAACiD,MAAJ,CAAWvB,GAAG,CAACrF,CAAJ,GAAQ2G,EAAE,CAAC3G,CAAtB,EAAyBqF,GAAG,CAACpF,CAAJ,GAAQ0G,EAAE,CAAC1G,CAApC;AACH,SAFD,MAEO;AACH0D,UAAAA,GAAG,CAACkD,MAAJ,CAAWxB,GAAG,CAACrF,CAAJ,GAAQ2G,EAAE,CAAC3G,CAAtB,EAAyBqF,GAAG,CAACpF,CAAJ,GAAQ0G,EAAE,CAAC1G,CAApC;AACH;;AACDqC,QAAAA,CAAC;AACJ;;AAGD,UAAIkE,SAAJ,EAAe;AACX7C,QAAAA,GAAG,CAAC6C,SAAJ;AACH;;AAGD,UAAIlB,EAAE,CAACzB,UAAP,EAAmB;AACfF,QAAAA,GAAG,CAACI,IAAJ;AACH;;AAGD,UAAIuB,EAAE,CAACxB,YAAP,EAAqB;AACjBH,QAAAA,GAAG,CAACK,MAAJ;AACH;;AAGD,UAAIsB,EAAE,CAAC1B,UAAP,EAAmB;AACfD,QAAAA,GAAG,CAACgC,OAAJ;AACH;AACJ;AACJ;;;;MCvDQmB,mBAAmB9D;AAC5BC,EAAAA,YAAYT;AACR,UAAMA,IAAN;AACA,SAAKxD,IAAL,GAAY,YAAZ;AACH;;AAEMmE,EAAAA,KAAK;AACR,QAAIkC,GAAG,GAAG,KAAK7C,IAAL,CAAUjD,KAApB;AAGA,QAAI6G,MAAM,GAAGf,GAAG,CAACvE,KAAJ,GAAY,CAAzB;AACA,QAAIiG,KAAK,GAAGC,UAAU,CAAC,KAAKxE,IAAL,CAAU1D,KAAV,CAAgBiI,KAAjB,CAAV,IAA+C,CAA3D;AAEA,QAAIE,MAAM,GAAGlH,OAAO,CAACsF,GAAG,CAACrF,CAAJ,GAAQoG,MAAT,EAAiBf,GAAG,CAACpF,CAAJ,GAAQmG,MAAzB,CAApB;AACA,QAAI5F,KAAK,GAAIE,IAAI,CAAC4F,EAAL,GAAU,CAAX,GAAgBS,KAA5B;AAEA,QAAIL,IAAI,GAAW,EAAnB;;AACA,SAAK,IAAIpE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGyE,KAApB,EAA2BzE,CAAC,EAA5B,EAAgC;AAC5B,UAAIqE,EAAE,GAAGrG,OAAO,CAAC2G,MAAD,EAASzG,KAAK,GAAG8B,CAAjB,EAAoB8D,MAApB,CAAhB;AACAM,MAAAA,IAAI,CAAC1E,IAAL,CAAU2E,EAAV;AACH;;AAGD,QAAI,KAAK7D,MAAT,EAAiB;AACb,UAAIa,GAAG,GAAG,KAAKb,MAAL,CAAYiC,UAAZ,CAAuB,IAAvB,CAAV;AACA,UAAIO,EAAE,GAAG,KAAK5B,+BAAL,CAAqCC,GAArC,EAA0C,KAAKnB,IAAL,CAAU1D,KAApD,CAAT;;AAGA,UAAIwG,EAAE,CAAC1B,UAAP,EAAmB;AACfD,QAAAA,GAAG,CAAC4B,IAAJ;AACH;;AAGD5B,MAAAA,GAAG,CAAC6B,SAAJ;AACA,UAAIlD,CAAC,GAAG,CAAR;;AACA,WAAK,IAAIqE,EAAT,IAAeD,IAAf,EAAqB;AACjB,YAAIpE,CAAC,KAAK,CAAV,EAAa;AACTqB,UAAAA,GAAG,CAACiD,MAAJ,CAAWD,EAAE,CAAC3G,CAAd,EAAiB2G,EAAE,CAAC1G,CAApB;AACH,SAFD,MAEO;AACH0D,UAAAA,GAAG,CAACkD,MAAJ,CAAWF,EAAE,CAAC3G,CAAd,EAAiB2G,EAAE,CAAC1G,CAApB;AACH;;AACD,YAAIqC,CAAC,KAAKoE,IAAI,CAACrE,MAAL,GAAc,CAAxB,EAA2B;AACvBsB,UAAAA,GAAG,CAAC6C,SAAJ;AACH;;AACDlE,QAAAA,CAAC;AACJ;;AAGD,UAAIgD,EAAE,CAACzB,UAAP,EAAmB;AACfF,QAAAA,GAAG,CAACI,IAAJ;AACH;;AAGD,UAAIuB,EAAE,CAACxB,YAAP,EAAqB;AACjBH,QAAAA,GAAG,CAACK,MAAJ;AACH;;AAGD,UAAIsB,EAAE,CAAC1B,UAAP,EAAmB;AACfD,QAAAA,GAAG,CAACgC,OAAJ;AACH;AACJ;AACJ;;;;MC9DQuB,iBAAiBlE;AAC7BC,EAAAA,YAAYT;AACX,UAAMA,IAAN;AACA,SAAKxD,IAAL,GAAY,UAAZ;AACA;;AAEMmE,EAAAA,KAAK;AACXlE,IAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyB,KAAKsD,IAA9B;AACA;;;;MCRW2E,oBAAoBnE;AAChCC,EAAAA,YAAYT;AACX,UAAMA,IAAN;AACA,SAAKxD,IAAL,GAAY,aAAZ;AACA;;AAEMmE,EAAAA,KAAK;AACXlE,IAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4B,KAAKsD,IAAjC;AACA;;;;ACRF,IAAI4E,OAAO,GAAG,CAAd;AACA,MAAaC,iBAAiBrE;AAC1BC,EAAAA,YAAYT;AACR,UAAMA,IAAN;AACA,SAAKxD,IAAL,GAAY,UAAZ;AACH;;AAEMmE,EAAAA,KAAK;AACR,QAAIkC,GAAG,GAAG,KAAK7C,IAAL,CAAUjD,KAApB;;AAEA,QAAI,KAAKuD,MAAT,EAAiB;AACb,WAAKQ,UAAL,CAAgB,KAAKR,MAArB;AACA,UAAI8B,SAAS,GAAG,KAAKpC,IAAL,CAAUlD,KAA1B;;AACA,UAAI,CAACsF,SAAL,EAAgB;AACZA,QAAAA,SAAS,GAAGC,QAAQ,CAACjG,aAAT,CAAuB,QAAvB,CAAZ;AACAgG,QAAAA,SAAS,CAACP,EAAV,uBAAmC+C,OAAO,IAA1C;AACAxC,QAAAA,SAAS,CAAC7D,MAAV,GAAmBsE,GAAG,CAACtE,MAAvB;AACA6D,QAAAA,SAAS,CAAC9D,KAAV,GAAkBuE,GAAG,CAACvE,KAAtB;AACA,aAAK0B,IAAL,CAAUlD,KAAV,GAAkBsF,SAAlB;AACH;;AACD,UAAIE,UAAU,GAAGF,SAAS,CAACG,UAAV,CAAqB,IAArB,CAAjB;;AACA,UAAID,UAAJ,EAAgB;AACZA,QAAAA,UAAU,CAACE,SAAX,CAAqBK,GAAG,CAACrF,CAAzB,EAA4BqF,GAAG,CAACpF,CAAhC,EAAmCoF,GAAG,CAACvE,KAAvC,EAA8CuE,GAAG,CAACtE,MAAlD;AACA,aAAK+B,MAAL,GAAc8B,SAAd;AACH;AACJ;AACJ;;;;MC1BQ0C,oBAAoBtE;AAC7BC,EAAAA,YAAYT;AACR,UAAMA,IAAN;AACA,SAAKxD,IAAL,GAAY,aAAZ;AACH;;AAEMmE,EAAAA,KAAK;AACR,QAAIkC,GAAG,GAAG,KAAK7C,IAAL,CAAUjD,KAApB;;AAEA,QAAI,KAAKiD,IAAL,CAAUnD,SAAd,EAAyB;AACrB,UAAIyD,MAAM,GAAG,KAAKS,SAAL,EAAb;;AACA,UAAIT,MAAJ,EAAY;AACR,YAAIoC,WAAW,GAAGpC,MAAM,CAACiC,UAAP,CAAkB,IAAlB,CAAlB;AACAG,QAAAA,WAAW,CAACC,SAAZ,CAAsB,KAAK3C,IAAL,CAAUlD,KAAhC,EAAuC+F,GAAG,CAACrF,CAA3C,EAA8CqF,GAAG,CAACpF,CAAlD;AAGA,aAAK6C,MAAL,GAAcA,MAAd;AACH;AACJ,KATD,MASO;AACH,UAAIA,MAAM,GAAG,KAAKA,MAAlB;;AACA,UAAIA,MAAM,IAAI,KAAKN,IAAL,CAAUlD,KAAxB,EAA+B;AAC3B,YAAIqE,GAAG,GAAGb,MAAM,CAACiC,UAAP,CAAkB,IAAlB,CAAV;AACApB,QAAAA,GAAG,SAAH,IAAAA,GAAG,WAAH,YAAAA,GAAG,CAAEwB,SAAL,CAAe,KAAK3C,IAAL,CAAUlD,KAAzB,EAAgC+F,GAAG,CAACrF,CAApC,EAAuCqF,GAAG,CAACpF,CAA3C;AACH;AACJ;AACJ;;;;SCZWsH,eAAe/E;AAC3B,MAAIgF,IAAI,GAAe,EAAvB;;AAEA,MAAIhF,IAAI,CAACnD,SAAT,EAAoB;AAEhB,YAAQmD,IAAI,CAACxD,IAAb;AACI,WAAK,OAAL;AACA,WAAK,SAAL;AACIwI,QAAAA,IAAI,CAACxF,IAAL,CAAU,IAAI2C,QAAJ,CAAanC,IAAb,CAAV;AACA;;AAEJ,WAAK,OAAL;AACA,WAAK,SAAL;AACIgF,QAAAA,IAAI,CAACxF,IAAL,CAAU,IAAIkF,QAAJ,CAAa1E,IAAb,CAAV;AACA;;AAEJ,WAAK,OAAL;AACA,WAAK,OAAL;AACA,WAAK,SAAL;AACIgF,QAAAA,IAAI,CAACxF,IAAL,CAAU,IAAIqF,QAAJ,CAAa7E,IAAb,CAAV;AACA;;AAEJ,WAAK,WAAL;AACA,WAAK,MAAL;AACA,WAAK,QAAL;AACA,WAAK,WAAL;AACA,WAAK,aAAL;AACIgF,QAAAA,IAAI,CAACxF,IAAL,CAAU,IAAIoD,YAAJ,CAAiB5C,IAAjB,CAAV;AACA;;AAEJ,WAAK,QAAL;AACA,WAAK,UAAL;AACA,WAAK,MAAL;AACA,WAAK,QAAL;AACIgF,QAAAA,IAAI,CAACxF,IAAL,CAAU,IAAI4D,OAAJ,CAAYpD,IAAZ,CAAV;AACA;;AAEJ,WAAK,QAAL;AACA,WAAK,QAAL;AACA,WAAK,UAAL;AACIgF,QAAAA,IAAI,CAACxF,IAAL,CAAU,IAAImE,SAAJ,CAAc3D,IAAd,CAAV;AACA;;AAEJ,WAAK,MAAL;AACA,WAAK,MAAL;AACA,WAAK,QAAL;AACIgF,QAAAA,IAAI,CAACxF,IAAL,CAAU,IAAIuE,OAAJ,CAAY/D,IAAZ,CAAV;AACA;;AAEJ,WAAK,SAAL;AACA,WAAK,SAAL;AACA,WAAK,WAAL;AACIgF,QAAAA,IAAI,CAACxF,IAAL,CAAU,IAAI8E,UAAJ,CAAetE,IAAf,CAAV;AACA;AAhDR;;AAoDA,SAAK,IAAIV,KAAT,IAAkBU,IAAI,CAACzD,QAAvB,EAAiC;AAC7ByI,MAAAA,IAAI,GAAGA,IAAI,CAACzF,MAAL,CAAYwF,cAAc,CAACzF,KAAD,CAA1B,CAAP;AACH;;AAGD,YAAQU,IAAI,CAACxD,IAAb;AACI,WAAK,OAAL;AACA,WAAK,SAAL;AACIwI,QAAAA,IAAI,CAACxF,IAAL,CAAU,IAAIiD,WAAJ,CAAgBzC,IAAhB,CAAV;AACA;;AAEJ,WAAK,OAAL;AACA,WAAK,SAAL;AACIgF,QAAAA,IAAI,CAACxF,IAAL,CAAU,IAAImF,WAAJ,CAAgB3E,IAAhB,CAAV;AACA;;AAEJ,WAAK,OAAL;AACA,WAAK,OAAL;AACA,WAAK,SAAL;AACIgF,QAAAA,IAAI,CAACxF,IAAL,CAAU,IAAIsF,WAAJ,CAAgB9E,IAAhB,CAAV;AACA;AAfR;AAiBH,GA5ED,MA4EO;AAEH,YAAQA,IAAI,CAACxD,IAAb;AACI,WAAK,OAAL;AACA,WAAK,OAAL;AACA,WAAK,SAAL;AACIwI,QAAAA,IAAI,CAACxF,IAAL,CAAU,IAAIsF,WAAJ,CAAgB9E,IAAhB,CAAV;AACA;AALR;AAOH;;AAED,SAAOgF,IAAP;AACH;;ACvGD,IAAI9H,KAAK,GAAe,EAAxB;AAEA,SAAgByD,MAAMX;AACrB,MAAI9C,KAAK,CAAC2C,MAAN,KAAiB,CAArB,EAAwB;AACvB3C,IAAAA,KAAK,GAAG6H,cAAc,CAAC/E,IAAD,CAAtB;AACAiF,IAAAA,SAAS;AACT;AACD;AAED,SAAgBA;AACf,MAAIC,GAAG,GAAgC,IAAvC;;AACA,SAAOhI,KAAK,CAAC2C,MAAN,GAAe,CAAtB,EAAyB;AACxBqF,IAAAA,GAAG,GAAGhI,KAAK,CAACiI,KAAN,EAAN;;AACA,QAAID,GAAJ,EAAS;AACRA,MAAAA,GAAG,CAACxE,UAAJ;AACA;AACD;AACD;;MCTY0E;AAoDT3E,EAAAA;AAnDO,kBAAA,GAAY,IAAZ;AAEC,mBAAA,GAAa,CAAb;AAED,aAAA,GAAaxB,MAAM,CAAC,EAAD,EAAK,EAAL,CAAnB;AACC,mBAAA,GAAmBZ,MAAM,CAAC,CAAD,EAAI,CAAJ,EAAO,EAAP,EAAW,EAAX,CAAzB;AAED,cAAA,GAAqB,IAArB;AAEC,cAAA,GAAqB,IAArB;AAED,oBAAA,GAA2B,IAA3B;AAEA,oBAAA,GAAsB,EAAtB;AAEA,kBAAA,GAAY,KAAZ;AAEA,+BAAA,GAAyB,KAAzB;AAEA,uBAAA,GAAgC,IAAhC;AAGA,kBAAA,GAAoB,CAApB;AA8BH,SAAKgH,IAAL,GAAY,KAAKA,IAAL,CAAUC,IAAV,CAAe,IAAf,CAAZ;;AACA,QAAI,KAAKC,SAAL,KAAmB,KAAvB,EAA8B;AAC1B,YAAMC,OAAO,GAAIC,CAAD;AACZ,YAAIA,CAAC,CAAC9F,GAAF,KAAU,GAAd,EAAmB;AACf,eAAK+F,iBAAL;AACA,cAAIC,QAAQ,GAAGC,WAAW,CAACC,GAAZ,KAAoB,EAAnC;AACA,eAAKR,IAAL,CAAU;AACNS,YAAAA,aAAa,EAAE,MAAMH,QAAQ,GAAGC,WAAW,CAACC,GAAZ,EAD1B;AAENE,YAAAA,UAAU,EAAE;AAFN,WAAV;AAIH;AACJ,OATD;;AAUA1D,MAAAA,QAAQ,CAAC2D,gBAAT,CAA0B,OAA1B,EAAmCR,OAAnC;AACH;AACJ;;AA1Cc,MAAJS,IAAI;AACX,WAAO,KAAKC,KAAZ;AACH;;AAEc,MAAJlG,IAAI;AACX,WAAO,KAAKmG,KAAZ;AACH;;AAEc,MAAJnG,IAAI,CAACY,GAAD;AACX,SAAKuF,KAAL,GAAavF,GAAb;AACH;;AAEMwF,EAAAA,OAAO,CAACC,EAAD;AACV,SAAKH,KAAL,GAAa;AACT1J,MAAAA,IAAI,EAAE,MADG;AAETH,MAAAA,IAAI,EAAEgK,EAFG;AAGT/J,MAAAA,KAAK,EAAE,EAHE;AAITC,MAAAA,QAAQ,EAAE,EAJD;AAKTI,MAAAA,SAAS,EAAE,IALF;AAMTC,MAAAA,KAAK,EAAE,EANE;AAOTC,MAAAA,SAAS,EAAE,KAPF;AAQTC,MAAAA,KAAK,EAAE,IARE;AASTC,MAAAA,KAAK,EAAEsB,MAAM,CAAC,CAAD,EAAI,CAAJ,EAAO,KAAKiI,IAAL,CAAUhI,KAAjB,EAAwB,KAAKgI,IAAL,CAAU/H,MAAlC;AATJ,KAAb;AAWA,SAAKgI,WAAL,CAAiB/G,IAAjB,CAAsB,KAAK0G,KAA3B;AACH;;AAmBMM,EAAAA,KAAK;AACR,QAAI,CAAC,KAAKC,SAAV,EAAqB;AACjB,UAAIC,MAAM,CAACC,mBAAP,IAA8B,IAAlC,EAAwC;AACpC,aAAKC,cAAL,GAAsBD,mBAAmB,CAAC,KAAKtB,IAAN,CAAzC;AACH,OAFD,MAEO;AACHwB,QAAAA,UAAU,CAAC;AACP,eAAKxB,IAAL,CAAU;AACNS,YAAAA,aAAa,EAAE;AACX,qBAAO,EAAP;AACH,aAHK;AAINC,YAAAA,UAAU,EAAE;AAJN,WAAV;AAMH,SAPS,EAOP,EAPO,CAAV;AAQH;;AACD,WAAKU,SAAL,GAAiB,IAAjB;AACH;AACJ;;AAEMK,EAAAA,IAAI;AACP,SAAKL,SAAL,GAAiB,KAAjB;;AACA,QAAI,KAAKG,cAAT,EAAyB;AACrBG,MAAAA,kBAAkB,CAAC,KAAKH,cAAN,CAAlB;AACA,WAAKA,cAAL,GAAsB,IAAtB;AACH;AACJ;;AAEMvB,EAAAA,IAAI,CAACM,QAAD;AACP,QAAIa,KAAK,GAAGZ,WAAW,CAACC,GAAZ,EAAZ;;AAGA,QAAI,KAAKmB,WAAT,EAAsB;AAClB,WAAKC,cAAL,CAAoB,KAAKD,WAAzB;AACH;;AAED,QAAI,KAAKT,WAAL,CAAiB1G,MAAjB,KAA4B,CAA5B,IAAiC,KAAKqH,sBAA1C,EAAkE;AAC9D,WAAKC,eAAL;AACH;;AAED,WAAO,KAAKZ,WAAL,CAAiB1G,MAAjB,GAA0B,CAA1B,IAA+B8F,QAAQ,CAACG,aAAT,KAA2B,CAAjE,EAAoE;AAChE,WAAKsB,qBAAL;AACH;;AAED,QAAI,KAAKb,WAAL,CAAiB1G,MAAjB,KAA4B,CAA5B,IAAiC,KAAKqG,KAAL,IAAc,IAAnD,EAAyD;AACrD,WAAKmB,sBAAL,CAA4B,KAAKnB,KAAjC,EAAwC,IAAxC;AACA,WAAKoB,uBAAL,CAA6B,KAAKpB,KAAlC,EAAyC,IAAzC;AACA,WAAKqB,eAAL,CAAqB,KAAKrB,KAA1B;AACA,WAAKsB,UAAL;AACH;;AAED,QAAI,KAAKjB,WAAL,CAAiB1G,MAAjB,KAA4B,CAA5B,IAAiC,KAAKqG,KAAL,KAAe,IAApD,EAA0D;AACtD,UAAI,KAAKc,WAAT,EAAsB;AAClB,aAAKS,eAAL,CAAqB,KAAKT,WAA1B;AACH;AACJ;;AAED,QAAI,KAAKJ,cAAT,EAAyB;AACrBG,MAAAA,kBAAkB,CAAC,KAAKH,cAAN,CAAlB;AACA,WAAKA,cAAL,GAAsB,IAAtB;AACH;;AACD,QAAK,KAAKH,SAAL,IAAkB,KAAKlB,SAAxB,IAAsC,KAAKgB,WAAL,CAAiB1G,MAAjB,GAA0B,CAApE,EAAuE;AACnE,UAAI6G,MAAM,CAACC,mBAAP,IAA8B,IAAlC,EAAwC;AACpC,aAAKC,cAAL,GAAsBD,mBAAmB,CAAC,KAAKtB,IAAN,CAAzC;AACH,OAFD,MAEO;AACHwB,QAAAA,UAAU,CAAC;AACP,eAAKxB,IAAL,CAAU;AACNS,YAAAA,aAAa,EAAE;AACX,qBAAO,EAAP;AACH,aAHK;AAINC,YAAAA,UAAU,EAAE;AAJN,WAAV;AAMH,SAPS,EAOP,EAPO,CAAV;AAQH;AACJ;;AAED,QAAI2B,IAAI,GAAG9B,WAAW,CAACC,GAAZ,KAAoBW,KAA/B;AACH;;AAEMY,EAAAA,qBAAqB;AACxB,QAAIO,CAAC,GAAG,KAAKpB,WAAL,CAAiBpB,KAAjB,EAAR;;AACA,QAAIwC,CAAJ,EAAO;AACH,WAAKxB,KAAL,GAAawB,CAAb;AACH,KAFD,MAEO;AACH,WAAKxB,KAAL,GAAa,IAAb;AACH;;AACD,QAAI,KAAKA,KAAT,EAAgB;AACZ,WAAKsB,eAAL,CAAqB,KAAKtB,KAA1B,EAAiC,KAAjC;AACA,UAAIyB,IAAI,GAAW,KAAKC,UAAL,CAAgB,KAAK1B,KAArB,CAAnB;;AACA,WAAK,IAAIwB,EAAT,IAAcC,IAAd,EAAoB;AAChB,aAAKrB,WAAL,CAAiB/G,IAAjB,CAAsBmI,EAAtB;AACH;AACJ;AACJ;;AAEMH,EAAAA,UAAU;AACb,SAAKR,WAAL,GAAmB,KAAKd,KAAxB;AACA,SAAKA,KAAL,GAAa,IAAb;;AAGA,QAAI,KAAKc,WAAT,EAAsB;AAClB,WAAKc,kBAAL,CAAwB,KAAKd,WAA7B;AACA,WAAKe,UAAL;AACAtL,MAAAA,OAAO,CAACC,GAAR,CAAY,yBAAZ;AAEA,WAAKsL,WAAL,CAAiB,KAAKhB,WAAtB;AACArG,MAAAA,KAAK,CAAC,KAAKqG,WAAN,CAAL;AACH;AACJ;;AAEMM,EAAAA,uBAAuB,CAACtH,IAAD,EAAaiI,MAAb;AAC1B,QAAIA,MAAM,IAAIA,MAAM,CAAClL,KAAjB,IAA0BiD,IAAI,CAAC1D,KAA/B,IAAwC0D,IAAI,CAACjD,KAAjD,EAAwD;AACpD,UAAIiD,IAAI,CAACxD,IAAL,KAAc,UAAlB,EAA8B;AAE1BwD,QAAAA,IAAI,CAACjD,KAAL,GAAa,EAAE,GAAGkL,MAAM,CAAClL,KAAZ;AAAmBS,UAAAA,CAAC,EAAE,CAAtB;AAAyBC,UAAAA,CAAC,EAAE;AAA5B,SAAb;AACH;;AAED,UAAIyK,CAAC,GAAGlI,IAAI,CAAC1D,KAAL,CAAWgC,KAAnB;AACA,UAAI6J,CAAC,GAAGnI,IAAI,CAAC1D,KAAL,CAAWsH,MAAnB;;AACA,UAAIsE,CAAC,IAAI,OAAOA,CAAP,KAAa,QAAlB,IAA8BlI,IAAI,CAAC1D,KAAL,CAAWgC,KAAX,CAAiB8J,QAAjB,CAA0B,GAA1B,CAAlC,EAAkE;AAC9D,YAAIC,EAAE,GAAG7D,UAAU,CAACxE,IAAI,CAAC1D,KAAL,CAAWgC,KAAZ,CAAV,GAA+B,GAAxC;AACA0B,QAAAA,IAAI,CAACjD,KAAL,CAAWuB,KAAX,GAAmB2J,MAAM,CAAClL,KAAP,CAAauB,KAAb,GAAqB+J,EAAxC;AACH;;AAED,UAAI,CAACH,CAAD,IAAMC,CAAV,EAAa;AACT,YAAIA,CAAC,IAAI,OAAOA,CAAP,KAAa,QAAlB,IAA8BA,CAAC,CAACC,QAAF,CAAW,GAAX,CAAlC,EAAmD;AAC/C,cAAIE,EAAE,GAAG9D,UAAU,CAAC2D,CAAD,CAAV,GAAgB,GAAzB;AACAnI,UAAAA,IAAI,CAACjD,KAAL,CAAWuB,KAAX,GAAmB2J,MAAM,CAAClL,KAAP,CAAauB,KAAb,GAAqBgK,EAArB,GAA0B,CAA7C;AACH,SAHD,MAGO;AACHtI,UAAAA,IAAI,CAACjD,KAAL,CAAWuB,KAAX,GAAmBkG,UAAU,CAAC2D,CAAD,CAAV,GAAgB,CAAnC;AACH;AACJ;;AACD,UAAII,CAAC,GAAGvI,IAAI,CAAC1D,KAAL,CAAWiC,MAAnB;;AACA,UAAIgK,CAAC,IAAI,OAAOA,CAAP,KAAa,QAAlB,IAA8BvI,IAAI,CAAC1D,KAAL,CAAWiC,MAAX,CAAkB6J,QAAlB,CAA2B,GAA3B,CAAlC,EAAmE;AAC/D,YAAII,EAAE,GAAGhE,UAAU,CAACxE,IAAI,CAAC1D,KAAL,CAAWiC,MAAZ,CAAV,GAAgC,GAAzC;AACAyB,QAAAA,IAAI,CAACjD,KAAL,CAAWwB,MAAX,GAAoB0J,MAAM,CAAClL,KAAP,CAAawB,MAAb,GAAsBiK,EAA1C;AACH;;AACD,UAAIhL,CAAC,GAAGwC,IAAI,CAAC1D,KAAL,CAAWkB,CAAnB;;AACA,UAAIA,CAAC,IAAI,OAAOA,CAAP,KAAa,QAAlB,IAA8BA,CAAC,CAAC4K,QAAF,CAAW,GAAX,CAAlC,EAAmD;AAC/C,YAAIK,EAAE,GAAGjE,UAAU,CAACxE,IAAI,CAAC1D,KAAL,CAAWkB,CAAZ,CAAV,GAA2B,GAApC;AACA,YAAIkL,IAAI,GAAGT,MAAM,CAAClL,KAAP,CAAauB,KAAb,GAAqBmK,EAAhC;AACAzI,QAAAA,IAAI,CAACjD,KAAL,CAAWS,CAAX,GAAekL,IAAf;AACH;;AACD,UAAIjL,CAAC,GAAGuC,IAAI,CAAC1D,KAAL,CAAWmB,CAAnB;;AACA,UAAIA,CAAC,IAAI,OAAOA,CAAP,KAAa,QAAlB,IAA8BA,CAAC,CAAC2K,QAAF,CAAW,GAAX,CAAlC,EAAmD;AAC/C,YAAIO,EAAE,GAAGnE,UAAU,CAACxE,IAAI,CAAC1D,KAAL,CAAWmB,CAAZ,CAAV,GAA2B,GAApC;AACA,YAAImL,IAAI,GAAGX,MAAM,CAAClL,KAAP,CAAawB,MAAb,GAAsBoK,EAAjC;AACA3I,QAAAA,IAAI,CAACjD,KAAL,CAAWU,CAAX,GAAemL,IAAf;AACH;;AAGD5I,MAAAA,IAAI,CAACjD,KAAL,CAAWS,CAAX,GAAewC,IAAI,CAACjD,KAAL,CAAWS,CAAX,GAAeyK,MAAM,CAAClL,KAAP,CAAaS,CAA3C;AACAwC,MAAAA,IAAI,CAACjD,KAAL,CAAWU,CAAX,GAAeuC,IAAI,CAACjD,KAAL,CAAWU,CAAX,GAAewK,MAAM,CAAClL,KAAP,CAAaU,CAA3C;AACH;;AAED,SAAK,IAAI6B,KAAT,IAAkBU,IAAI,CAACzD,QAAvB,EAAiC;AAC7B,WAAK+K,uBAAL,CAA6BhI,KAA7B,EAAoCU,IAApC;AACH;AACJ;;AAEMqH,EAAAA,sBAAsB,CAACrH,IAAD,EAAaiI,MAAb;AACzB,SAAK,IAAI3I,KAAT,IAAkBU,IAAI,CAACzD,QAAvB,EAAiC;AAC7B,WAAK8K,sBAAL,CAA4B/H,KAA5B,EAAmCU,IAAnC;AACH;;AAED,QAAIjD,KAAK,GAAGsB,MAAM,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAlB;;AAEA,QAAI2B,IAAI,CAAC1D,KAAL,CAAWkB,CAAf,EAAkB;AACdT,MAAAA,KAAK,CAACS,CAAN,GAAUgH,UAAU,CAACxE,IAAI,CAAC1D,KAAL,CAAWkB,CAAZ,CAApB;AACH;;AAED,QAAIwC,IAAI,CAAC1D,KAAL,CAAWmB,CAAf,EAAkB;AACdV,MAAAA,KAAK,CAACU,CAAN,GAAU+G,UAAU,CAACxE,IAAI,CAAC1D,KAAL,CAAWmB,CAAZ,CAApB;AACH;;AAEDV,IAAAA,KAAK,CAACuB,KAAN,GAAc,KAAKuK,YAAL,CAAkB7I,IAAlB,CAAd;AACAjD,IAAAA,KAAK,CAACwB,MAAN,GAAe,KAAKuK,aAAL,CAAmB9I,IAAnB,CAAf;AAEAA,IAAAA,IAAI,CAACjD,KAAL,GAAaA,KAAb;AACH;;AAEM8L,EAAAA,YAAY,CAAC7I,IAAD;AACf,QAAIkI,CAAC,GAAG,CAAR;;AACA,QAAIlI,IAAI,CAACjD,KAAL,IAAciD,IAAI,CAACjD,KAAL,CAAWuB,KAA7B,EAAoC;AAChC4J,MAAAA,CAAC,GAAGlI,IAAI,CAACjD,KAAL,CAAWuB,KAAf;AACH,KAFD,MAEO,IAAI0B,IAAI,CAAC1D,KAAL,CAAWgC,KAAf,EAAsB;AACzB4J,MAAAA,CAAC,GAAG1D,UAAU,CAACxE,IAAI,CAAC1D,KAAL,CAAWgC,KAAZ,CAAd;AACH,KAFM,MAEA,IAAI0B,IAAI,CAAC1D,KAAL,CAAWyM,eAAf,EAAgC;AACnCb,MAAAA,CAAC,GAAG1D,UAAU,CAACxE,IAAI,CAAC1D,KAAL,CAAWyM,eAAZ,CAAd;AACH,KAFM,MAEA;AACH,WAAK,IAAIzJ,KAAT,IAAkBU,IAAI,CAACzD,QAAvB,EAAiC;AAC7B2L,QAAAA,CAAC,GAAGhK,IAAI,CAAC8K,GAAL,CAASd,CAAT,EAAY,KAAKW,YAAL,CAAkBvJ,KAAlB,CAAZ,CAAJ;AACH;AACJ;;AACD,WAAO4I,CAAP;AACH;;AAEMY,EAAAA,aAAa,CAAC9I,IAAD;AAChB,QAAIuI,CAAC,GAAG,CAAR;;AACA,QAAIvI,IAAI,CAACjD,KAAL,IAAciD,IAAI,CAACjD,KAAL,CAAWwB,MAA7B,EAAqC;AACjCgK,MAAAA,CAAC,GAAGvI,IAAI,CAACjD,KAAL,CAAWwB,MAAf;AACH,KAFD,MAEO,IAAIyB,IAAI,CAAC1D,KAAL,CAAWiC,MAAf,EAAuB;AAC1BgK,MAAAA,CAAC,GAAG/D,UAAU,CAACxE,IAAI,CAAC1D,KAAL,CAAWiC,MAAZ,CAAd;AACH,KAFM,MAEA,IAAIyB,IAAI,CAAC1D,KAAL,CAAW2M,gBAAf,EAAiC;AACpCV,MAAAA,CAAC,GAAG/D,UAAU,CAACxE,IAAI,CAAC1D,KAAL,CAAW2M,gBAAZ,CAAd;AACH,KAFM,MAEA;AACH,WAAK,IAAI3J,KAAT,IAAkBU,IAAI,CAACzD,QAAvB,EAAiC;AAC7BgM,QAAAA,CAAC,GAAGrK,IAAI,CAAC8K,GAAL,CAAST,CAAT,EAAY,KAAKO,aAAL,CAAmBxJ,KAAnB,CAAZ,CAAJ;AACH;AACJ;;AACD,WAAOiJ,CAAP;AACH;;AAEMP,EAAAA,WAAW,CAAChI,IAAD,EAAakJ,QAAgB,CAA7B;AACd,QAAIC,MAAM,GAAG,GAAGC,MAAH,CAAUF,KAAK,GAAG,CAAlB,EAAqB,GAArB,CAAb;;AACA,QAAIlJ,IAAI,CAACjD,KAAT,EAAgB;AACZN,MAAAA,OAAO,CAACC,GAAR,CACIyM,MADJ,EAEInJ,IAAI,CAACxD,IAFT,EAGI,IAHJ,EAIIwD,IAAI,CAACjD,KAAL,CAAWS,CAJf,EAKI,MALJ,EAMIwC,IAAI,CAACjD,KAAL,CAAWU,CANf,EAOI,MAPJ,EAQIuC,IAAI,CAACjD,KAAL,CAAWuB,KARf,EASI,MATJ,EAUI0B,IAAI,CAACjD,KAAL,CAAWwB,MAVf;AAYH,KAbD,MAaO;AACH9B,MAAAA,OAAO,CAACC,GAAR,CAAYyM,MAAZ,EAAoBnJ,IAAI,CAACxD,IAAzB,EAA+B,UAA/B,EAA2CwD,IAA3C;AACH;;AAED,SAAK,IAAIV,KAAT,IAAkBU,IAAI,CAACzD,QAAvB,EAAiC;AAC7B,WAAKyL,WAAL,CAAiB1I,KAAjB,EAAwB4J,KAAK,GAAG,CAAhC;AACH;AACJ;;AAEMxD,EAAAA,iBAAiB;AACpB,SAAKwB,sBAAL,GAA8B,IAA9B;AACH;;AAEMC,EAAAA,eAAe;AAClB,SAAKD,sBAAL,GAA8B,KAA9B;;AACA,QAAI,KAAKF,WAAT,EAAsB;AAClB,WAAKqC,UAAL,GAAkBhL,MAAM,CAAC,CAAD,EAAI,CAAJ,EAAO,KAAKiI,IAAL,CAAUhI,KAAjB,EAAwB,KAAKgI,IAAL,CAAU/H,MAAlC,CAAxB;AACA,WAAK2H,KAAL,GAAa;AACT1J,QAAAA,IAAI,EAAE,MADG;AAETH,QAAAA,IAAI,EAAE,KAAK2K,WAAL,CAAiB3K,IAFd;AAGTC,QAAAA,KAAK,EAAE,EACH,GAAG,KAAK0K,WAAL,CAAiB1K,KADjB;AAEHgC,UAAAA,KAAK,EAAE,KAAKgI,IAAL,CAAUhI,KAFd;AAGHC,UAAAA,MAAM,EAAE,KAAK+H,IAAL,CAAU/H;AAHf,SAHE;AAQThC,QAAAA,QAAQ,EAAE,KAAKyK,WAAL,CAAiBzK,QARlB;AASTI,QAAAA,SAAS,EAAEoD,UAAU,CAAC,KAAKiH,WAAN,CATZ;AAUTpK,QAAAA,KAAK,EAAE,KAAKoK,WAAL,CAAiBpK,KAVf;AAWTC,QAAAA,SAAS,EAAE,KAXF;AAYTC,QAAAA,KAAK,EAAE,IAZE;AAaTC,QAAAA,KAAK,EAAE;AAbE,OAAb;AAeH;;AACD,QAAI,KAAKmJ,KAAT,EAAgB;AACZ,WAAKK,WAAL,GAAmB,CAAC,KAAKL,KAAN,CAAnB;AACH;AACJ;;AAEDe,EAAAA,cAAc,CAACjH,IAAD;AAEV,SAAK,IAAIV,KAAT,IAAkBU,IAAI,CAACzD,QAAvB,EAAiC;AAC7B,WAAK0K,cAAL,CAAoB3H,KAApB;AACH;;AAED,SAAK,IAAIgK,IAAT,IAAiBtJ,IAAI,CAACpD,KAAtB,EAA6B;AACzB,WAAK,IAAI2M,MAAT,IAAmBD,IAAI,CAAClM,YAAxB,EAAsC;AAClCmM,QAAAA,MAAM;AACT;;AACDD,MAAAA,IAAI,CAAClM,YAAL,GAAoB,EAApB;AACH;AACJ;;AAEDqK,EAAAA,eAAe,CAACzH,IAAD,EAAawJ,kBAA2B,IAAxC;AAEX,QAAIA,eAAJ,EAAqB;AACjB,WAAK,IAAIlK,KAAT,IAAkBU,IAAI,CAACzD,QAAvB,EAAiC;AAC7B,aAAKkL,eAAL,CAAqBnI,KAArB;AACH;AACJ;;AAED,SAAK,IAAIgK,IAAT,IAAiBtJ,IAAI,CAACpD,KAAtB,EAA6B;AACzB,WAAK,IAAI2M,MAAT,IAAmBD,IAAI,CAACnM,cAAxB,EAAwC;AACpC,YAAIsM,OAAO,GAAGH,IAAI,CAACpM,KAAL,CAAW+D,GAAX,EAAd;;AACA,YAAIwI,OAAJ,EAAa;AACTA,UAAAA,OAAO;AACV;;AACD,YAAIC,EAAE,GAAGH,MAAM,EAAf;;AACA,YAAIG,EAAJ,EAAQ;AACJJ,UAAAA,IAAI,CAACpM,KAAL,CAAWsC,IAAX,CAAgBkK,EAAhB;AACH;AACJ;;AACDJ,MAAAA,IAAI,CAACnM,cAAL,GAAsB,EAAtB;AACH;AACJ;;AAEDoK,EAAAA,eAAe,CAACvH,IAAD;AAEX,SAAK,IAAIV,KAAT,IAAkBU,IAAI,CAACzD,QAAvB,EAAiC;AAC7B,WAAKgL,eAAL,CAAqBjI,KAArB;AACH;;AAED,SAAK6G,KAAL,GAAanG,IAAb;;AACA,SAAK,IAAIsJ,IAAT,IAAiBtJ,IAAI,CAACpD,KAAtB,EAA6B;AACzB,WAAK,IAAI2M,MAAT,IAAmBD,IAAI,CAAChM,aAAxB,EAAuC;AACnCiM,QAAAA,MAAM;AACT;;AACDD,MAAAA,IAAI,CAAChM,aAAL,GAAqB,EAArB;AACH;;AACD,SAAK6I,KAAL,GAAa,IAAb;AACH;;AAEM0B,EAAAA,UAAU,CAAC7H,IAAD;AACb,QAAI,CAACA,IAAI,CAACrD,SAAV,EAAqB;AAEjBqD,MAAAA,IAAI,CAACnD,SAAL,GAAiB,IAAjB;AACH;;AAED,QAAI8M,YAAY,GAAW,EAA3B;;AACA,QAAI3J,IAAI,CAAC3D,IAAL,YAAqBuN,QAAzB,EAAmC;AAE/B,WAAKC,SAAL,GAAiB,CAAjB;AACA7J,MAAAA,IAAI,CAACpD,KAAL,GAAa,EAAb;;AAGA,UAAIoD,IAAI,CAACrD,SAAT,EAAoB;AAChBgN,QAAAA,YAAY,GAAG3J,IAAI,CAACrD,SAAL,CAAeJ,QAA9B;AACH,OAFD,MAEO,IAAIyD,IAAI,CAACzD,QAAT,EAAmB;AACtBoN,QAAAA,YAAY,GAAG3J,IAAI,CAACzD,QAApB;AACH;;AAGD,UAAIuN,CAAC,GAAG9J,IAAI,CAAC3D,IAAb;AAMA2D,MAAAA,IAAI,CAACzD,QAAL,GAAgB,CAACuN,CAAC,CAAC9J,IAAI,CAAC1D,KAAN,EAAa0D,IAAI,CAACzD,QAAlB,CAAF,CAAhB;AACH,KApBD,MAoBO;AAEHoN,MAAAA,YAAY,GAAG3J,IAAI,CAACrD,SAAL,GAAiBqD,IAAI,CAACrD,SAAL,CAAeJ,QAAhC,GAA2C,EAA1D;AACH;;AAGD,QAAIwN,YAAY,GAAW7K,eAAe,CAACc,IAAI,CAACzD,QAAN,CAA1C;AAGA,QAAIyN,SAAS,GAAG,KAAKC,YAAL,CAAkBF,YAAlB,EAAgCJ,YAAhC,CAAhB;AAGA3J,IAAAA,IAAI,CAACzD,QAAL,GAAgByN,SAAS,CAACzN,QAA1B;AAKA,WAAOyD,IAAI,CAACzD,QAAZ;AACH;;AAEMuL,EAAAA,kBAAkB,CACrBG,MADqB,EAErBiC,YAAqB,KAFA;AAIrB,QAAIrN,SAAS,GACToL,MAAM,CAACpL,SAAP,IACCqN,SAAS,IACN,CAAC,CAAC,SAAD,EAAY,OAAZ,EAAqB,OAArB,EAA8B,SAA9B,EAAyC9B,QAAzC,CAAkDH,MAAM,CAACzL,IAAzD,CAHT;;AAKA,SAAK,IAAI8C,KAAT,IAAkB2I,MAAM,CAAC1L,QAAzB,EAAmC;AAC/BM,MAAAA,SAAS,GAAGA,SAAS,IAAI,KAAKiL,kBAAL,CAAwBxI,KAAxB,EAA+BzC,SAA/B,CAAzB;AACH;;AAED,QAAIA,SAAJ,EAAe;AACX,WAAK,IAAIyC,KAAT,IAAkB2I,MAAM,CAAC1L,QAAzB,EAAmC;AAC/B,aAAKuL,kBAAL,CAAwBxI,KAAxB,EAA+B,IAA/B;AACH;AACJ;;AACD2I,IAAAA,MAAM,CAACpL,SAAP,GAAmBA,SAAnB;AACA,WAAOA,SAAP;AACH;;AAEMoN,EAAAA,YAAY,CACfF,YADe,EAEfJ,YAFe;AAIf,QAAIpN,QAAQ,GAAW,EAAvB;AACA,QAAI4N,OAAO,GAAW,EAAtB;AACA,QAAItK,MAAM,GAAG3B,IAAI,CAAC8K,GAAL,CAASe,YAAY,CAAClK,MAAtB,EAA8B8J,YAAY,CAAC9J,MAA3C,CAAb;;AAEA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,MAApB,EAA4BC,CAAC,EAA7B,EAAiC;AAC7B,UAAI8H,IAAI,GAAGmC,YAAY,CAACjK,CAAD,CAAvB;AACA,UAAIsK,IAAI,GAAGT,YAAY,CAAC7J,CAAD,CAAvB;AACA,UAAIuK,QAAQ,GAAG,KAAKC,QAAL,CAAc1C,IAAd,EAAoBwC,IAApB,CAAf;;AACA,UAAIC,QAAJ,EAAc;AACV9N,QAAAA,QAAQ,CAACiD,IAAT,CAAc6K,QAAd;AACH;;AACD,UAAID,IAAJ,EAAU;AACN,YAAI,CAACC,QAAL,EAAe;AACXF,UAAAA,OAAO,CAAC3K,IAAR,CAAa4K,IAAb;AACH;AACJ;AACJ;;AAED,WAAO;AAAE7N,MAAAA,QAAF;AAAY4N,MAAAA;AAAZ,KAAP;AACH;;AAEMG,EAAAA,QAAQ,CAAC3M,CAAD,EAAiBC,CAAjB;AACX,QAAIgK,IAAI,GAAgB,IAAxB;AACA,QAAI2C,QAAQ,GAAG,KAAf;;AACA,QAAI,CAAC,CAAC5M,CAAF,IAAO,CAAC,CAACC,CAAb,EAAgB;AACZ2M,MAAAA,QAAQ,GAAG5M,CAAC,CAACtB,IAAF,IAAUuB,CAAC,CAACvB,IAAvB;AACH;;AAED,QAAIsB,CAAC,IAAIC,CAAL,IAAU2M,QAAd,EAAwB;AACpB,UAAI1N,SAAS,GAAG,KAAhB;;AACA,UAAI4C,gBAAgB,CAAC9B,CAAC,CAACrB,KAAH,EAAUsB,CAAC,CAACtB,KAAZ,CAApB,EAAwC;AACpCO,QAAAA,SAAS,GAAG,IAAZ;AACH;;AACD+K,MAAAA,IAAI,GAAG;AACHpL,QAAAA,IAAI,EAAEmB,CAAC,CAACnB,IADL;AAEHH,QAAAA,IAAI,EAAEsB,CAAC,CAACtB,IAFL;AAGHC,QAAAA,KAAK,EAAEqB,CAAC,CAACrB,KAHN;AAIHC,QAAAA,QAAQ,EAAEoB,CAAC,CAACpB,QAJT;AAKHM,QAAAA,SAAS,EAAEA,SALR;AAMHD,QAAAA,KAAK,EAAEgB,CAAC,CAAChB,KANN;AAOHE,QAAAA,KAAK,EAAEc,CAAC,CAACd,KAPN;AAQHH,QAAAA,SAAS,EAAEoD,UAAU,CAACnC,CAAD,CARlB;AASHb,QAAAA,KAAK,EAAEa,CAAC,CAACb;AATN,OAAP;AAWH,KAhBD,MAgBO,IAAIY,CAAC,IAAI,CAAC4M,QAAV,EAAoB;AACvB3C,MAAAA,IAAI,GAAG;AACHpL,QAAAA,IAAI,EAAEmB,CAAC,CAACnB,IADL;AAEHH,QAAAA,IAAI,EAAEsB,CAAC,CAACtB,IAFL;AAGHC,QAAAA,KAAK,EAAEqB,CAAC,CAACrB,KAHN;AAIHC,QAAAA,QAAQ,EAAEoB,CAAC,CAACpB,QAJT;AAKHI,QAAAA,SAAS,EAAE,IALR;AAMHE,QAAAA,SAAS,EAAE,IANR;AAOHD,QAAAA,KAAK,EAAE,EAPJ;AAQHE,QAAAA,KAAK,EAAE,IARJ;AASHC,QAAAA,KAAK,EAAEY,CAAC,CAACZ;AATN,OAAP;AAWH,KAZM,MAYA;AACHN,MAAAA,OAAO,CAAC+N,KAAR,CAAc,UAAd,EAA0B7M,CAA1B,EAA6BC,CAA7B,EAAgC2M,QAAhC;AACH;;AAED,WAAO3C,IAAP;AACH;;;;MC7gBQ6C;AAKThK,EAAAA;AAFO,iBAAA,GAAgC,EAAhC;AAGH,SAAKiK,YAAL,GAAoB,IAAItF,YAAJ,EAApB;AACH;;AAEDuF,EAAAA,QAAQ,CAACC,KAAD;AACJ,SAAKF,YAAL,CAAkBtE,OAAlB,CAA0BwE,KAAK,CAACtL,KAAhC;AACA,SAAK0C,QAAL,GAAgB4I,KAAK,CAAC5I,QAAtB;AACH;;AAEwB,MAAd6I,cAAc;AACrB,WAAO,KAAKH,YAAZ;AACH;;AAEqB,MAAXI,WAAW;AAClB,WAAO,KAAKJ,YAAZ;AACH;;AAEMlE,EAAAA,KAAK;;;AACR,8BAAKsE,WAAL,wEAAkBtE,KAAlB;AACH;;AAEMM,EAAAA,IAAI;;;AAGf,IAAIiE,gBAAgB,GAAe,IAAIN,UAAJ,EAAnC;AACA,SAAgB1I;AACZ,SAAOgJ,gBAAP;AACH;;MC3BYC,SAAS,GAAI1O,KAAD;AACrB,MAAI2O,YAAY,GAAGC,MAAM,CAAiB,IAAjB,CAAzB;AAEAC,EAAAA,WAAS,CAAC;AACN,QAAIF,YAAY,CAACG,OAAjB,EAA0B;AACtB,YAAMC,WAAW,GAAGJ,YAAY,CAACG,OAAb,CAAqBE,gBAArB,CAAsC,QAAtC,CAApB;AACA,UAAItJ,QAAQ,GAAG5C,KAAK,CAACmM,IAAN,CAAWF,WAAX,EAAwBlL,GAAxB,CAA6BH,IAAD;AACvC,eAAOA,IAAP;AACH,OAFc,CAAf;AAIA,UAAI8B,GAAG,GAAGC,mBAAmB,EAA7B;AACAD,MAAAA,GAAG,CAAC6I,QAAJ,CAAa;AACTrL,QAAAA,KAAK,EAAEhD,KAAK,CAACkP,OADJ;AAETxJ,QAAAA,QAAQ,EAAEA;AAFD,OAAb;AAIAF,MAAAA,GAAG,CAAC4I,YAAJ,CAAiBpE,IAAjB,GAAwBhK,KAAK,CAACgK,IAA9B;AACAxE,MAAAA,GAAG,CAAC0E,KAAJ;AACH;AACJ,GAfQ,EAeN,CAAClK,KAAK,CAACkP,OAAP,EAAgBP,YAAhB,EAA8B3O,KAAK,CAACgK,IAApC,CAfM,CAAT;AAiBA,SACImF,mBAAA,MAAA;AAAKC,IAAAA,GAAG,EAAET;AAAcU,IAAAA,SAAS,EAAC;GAAlC,EACKrP,KAAK,CAACsP,MAAN,CAAazL,GAAb,CAAkByK,KAAD,IACda,mBAAA,SAAA;AACI9L,IAAAA,GAAG,EAAEiL;AACL/I,IAAAA,EAAE,EAAE+I;AACJtM,IAAAA,KAAK,EAAEhC,KAAK,CAACgK,IAAN,CAAWhI;AAClBC,IAAAA,MAAM,EAAEjC,KAAK,CAACgK,IAAN,CAAW/H;GAJvB,CADH,CADL,CADJ;AAYH,CAhCM;;SCZSsN,gBAAgBlO,GAAUC;AACzC,MAAI,CAACD,CAAD,IAAM,CAACC,CAAX,EAAc;AACb,WAAO,KAAP;AACA;;AACD,MAAK,CAACD,CAAD,IAAMC,CAAP,IAAc,CAACA,CAAD,IAAMD,CAAxB,EAA4B;AAE3B,WAAO,IAAP;AACA;;AACD,MAAIA,CAAC,CAACkC,MAAF,KAAajC,CAAC,CAACiC,MAAnB,EAA2B;AAE1B,WAAO,IAAP;AACA;;AACD,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnC,CAAC,CAACkC,MAAtB,EAA8BC,CAAC,EAA/B,EAAmC;AAClC,QAAInC,CAAC,CAACmC,CAAD,CAAD,KAASlC,CAAC,CAACkC,CAAD,CAAd,EAAmB;AAElB,aAAO,IAAP;AACA;AACD;;AAED,SAAO,KAAP;AACA;;SCpBegM,eAAeC,KAAUjC;AACxC,SAAO,OAAOA,CAAP,IAAY,UAAZ,GAAyBA,CAAC,CAACiC,GAAD,CAA1B,GAAkCjC,CAAzC;AACA;;SCOekC;AACf,MAAI1C,IAAI,GAAgB,IAAxB;AACA,MAAI2C,OAAO,GAAwBlK,mBAAmB,GAAG8I,cAAzD;;AAEA,MAAIoB,OAAJ,EAAa;AACZ,QAAIA,OAAO,CAACjM,IAAZ,EAAkB;AACjBsJ,MAAAA,IAAI,GACH2C,OAAO,CAACjM,IAAR,CAAarD,SAAb,IACAsP,OAAO,CAACjM,IAAR,CAAarD,SAAb,CAAuBC,KADvB,IAEAqP,OAAO,CAACjM,IAAR,CAAarD,SAAb,CAAuBC,KAAvB,CAA6BqP,OAAO,CAACpC,SAArC,CAHD;AAIA;AACD;;AAED,SAAO;AACNoC,IAAAA,OADM;AAENC,IAAAA,QAAQ,EAAE5C;AAFJ,GAAP;AAIA;;SCrBe6B,UAAUgB,UAA8BC;AACvD,MAAIC,SAAS,GAAGL,YAAY,EAA5B;AACA,MAAIE,QAAQ,GAAGG,SAAS,CAACH,QAAzB;AACA,MAAID,OAAO,GAAGI,SAAS,CAACJ,OAAxB;;AAEA,MAAI,CAACA,OAAD,IAAY,CAACA,OAAO,CAACjM,IAAzB,EAA+B;AAC9B,UAAM,IAAIsM,KAAJ,CACL,yDADK,CAAN;AAGA;;AAED,MAAIhD,IAAI,GAAGtM,UAAU,EAArB;;AACA,MAAIkP,QAAJ,EAAc;AACb5C,IAAAA,IAAI,CAACrM,KAAL,GAAaiP,QAAQ,CAACjP,KAAtB;AACAqM,IAAAA,IAAI,CAACpM,KAAL,GAAagP,QAAQ,CAAChP,KAAtB;AACA;;AAED,MAAI2O,eAAe,CAACO,IAAD,EAAOF,QAAP,aAAOA,QAAP,uBAAOA,QAAQ,CAAEjP,KAAjB,CAAnB,EAA4C;AAC3CqM,IAAAA,IAAI,CAACnM,cAAL,CAAoBqC,IAApB,CAAyB2M,QAAzB;AACA7C,IAAAA,IAAI,CAACrM,KAAL,GAAamP,IAAb;AACA;;AACDH,EAAAA,OAAO,CAACjM,IAAR,CAAapD,KAAb,CAAmB4C,IAAnB,CAAwB8J,IAAxB;AACA2C,EAAAA,OAAO,CAACpC,SAAR;AACA;;SC1Be0C,iBAAiBC,OAAeC,SAAcL;AAC7DjB,EAAAA,SAAS,CAAC;AACT9I,IAAAA,QAAQ,CAAC2D,gBAAT,CAA0BwG,KAA1B,EAAiCC,OAAjC;AACA,WAAO;AACNpK,MAAAA,QAAQ,CAACqK,mBAAT,CAA6BF,KAA7B,EAAoCC,OAApC;AACA,KAFD;AAGA,GALQ,EAKN,CAAC,GAAGL,IAAJ,EAAUI,KAAV,EAAiBC,OAAjB,CALM,CAAT;AAMA;;SCHeE,WACZC,SACAC,cACAC,OAAY;AAEZ,MAAIT,SAAS,GAAGL,YAAY,EAA5B;AACA,MAAIE,QAAQ,GAAGG,SAAS,CAACH,QAAzB;AACA,MAAID,OAAO,GAAGI,SAAS,CAACJ,OAAxB;;AAEA,MAAI,CAACA,OAAD,IAAY,CAACA,OAAO,CAACjM,IAAzB,EAA+B;AAC3B,UAAM,IAAIsM,KAAJ,CACF,yDADE,CAAN;AAGH;;AAED,MAAIhD,IAAI,GAAGtM,UAAU,EAArB;;AACA,MAAI8P,IAAJ,EAAU;AACNxD,IAAAA,IAAI,CAACrM,KAAL,GAAa6P,IAAI,CAACD,YAAD,CAAjB;AACH,GAFD,MAEO;AACHvD,IAAAA,IAAI,CAACrM,KAAL,GAAaiP,QAAQ,GACfA,QAAQ,CAACjP,KADM,GAEf6O,cAAc,CAACiB,SAAD,EAAYF,YAAZ,CAFpB;AAGH;;AAED,QAAMG,OAAO,GAAGd,QAAQ,GAAGA,QAAQ,CAAChP,KAAZ,GAAoB,EAA5C;;AACA,OAAK,IAAIqM,MAAT,IAAmByD,OAAnB,EAA4B;AACxB1D,IAAAA,IAAI,CAACrM,KAAL,GAAa2P,OAAO,CAACtD,IAAI,CAACrM,KAAN,EAAasM,MAAb,CAApB;AACH;;AACD,MAAI2C,QAAJ,EAAc;AACVA,IAAAA,QAAQ,CAAChP,KAAT,GAAiB,EAAjB;AACH;;AAED,QAAM+P,QAAQ,GAAI1D,MAAD;AACbD,IAAAA,IAAI,CAACpM,KAAL,CAAWsC,IAAX,CAAgB+J,MAAhB;AACA0C,IAAAA,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAEvG,iBAAT;AACH,GAHD;;AAKAuG,EAAAA,OAAO,CAACjM,IAAR,CAAcpD,KAAd,CAAoB4C,IAApB,CAAyB8J,IAAzB;AACA2C,EAAAA,OAAO,CAACpC,SAAR;AACA,SAAO,CAACP,IAAI,CAACrM,KAAN,EAAagQ,QAAb,CAAP;AACH;;SCzCeC,SAASL;AACxB,SAAOF,UAAU,CAACb,cAAD,EAAiBe,YAAjB,CAAjB;AACA;;SCHeM,UAAUhB;AACzB,MAAIE,SAAS,GAAGL,YAAY,EAA5B;AACA,MAAIE,QAAQ,GAAGG,SAAS,CAACH,QAAzB;AACA,MAAID,OAAO,GAAGI,SAAS,CAACJ,OAAxB;;AAEA,MAAI,CAACA,OAAD,IAAY,CAACA,OAAO,CAACjM,IAAzB,EAA+B;AAC9B,UAAM,IAAIsM,KAAJ,CACL,wDADK,CAAN;AAGA;;AAED,QAAMhD,IAAI,GAAGtM,UAAU,EAAvB;AACAsM,EAAAA,IAAI,CAACrM,KAAL,GAAaiP,QAAQ,GAAGA,QAAQ,CAACjP,KAAZ,GAAoB;AAAE4I,IAAAA,GAAG,EAAE,CAAC,CAAR;AAAWuH,IAAAA,KAAK,EAAE,CAAC;AAAnB,GAAzC;;AAEA,QAAMC,MAAM,GAAG;AACd,QAAIxH,GAAG,GAAGyH,IAAI,CAACzH,GAAL,EAAV;AACA,QAAIuH,KAAK,GAAG,CAAC,CAAb;;AACA,QAAIlB,QAAQ,IAAIA,QAAQ,CAACjP,KAAT,CAAesQ,QAAf,GAA0B,CAA1C,EAA6C;AAC5CH,MAAAA,KAAK,GAAGvH,GAAG,GAAGqG,QAAQ,CAACjP,KAAT,CAAesQ,QAA7B;AACA;;AACDjE,IAAAA,IAAI,CAACrM,KAAL,GAAa;AAAEsQ,MAAAA,QAAQ,EAAE1H,GAAZ;AAAiBuH,MAAAA;AAAjB,KAAb;AACAjB,IAAAA,QAAQ,CAACtG,GAAD,EAAMuH,KAAN,CAAR;AACA,WAAO,IAAP;AACA,GATD;;AAUA9D,EAAAA,IAAI,CAAClM,YAAL,CAAkBoC,IAAlB,CAAuB6N,MAAvB;AAEApB,EAAAA,OAAO,CAACjM,IAAR,CAAapD,KAAb,CAAmB4C,IAAnB,CAAwB8J,IAAxB;AACA2C,EAAAA,OAAO,CAACpC,SAAR;AACA;;SCpBe2D;AACZ,QAAM;AAAEvB,IAAAA;AAAF,MAAcD,YAAY,EAAhC;AAEA,MAAIyB,KAAK,GAA4B;AACjCC,IAAAA,SAAS,EAAE,CADsB;AAEjCC,IAAAA,UAAU,EAAE,CAFqB;AAGjCC,IAAAA,OAAO,EAAE;AAHwB,GAArC;;AAKA,MAAI3B,OAAJ,EAAa;AACTwB,IAAAA,KAAK,GAAG;AACJC,MAAAA,SAAS,EAAEzB,OAAO,CAAC3F,IAAR,CAAahI,KADpB;AAEJqP,MAAAA,UAAU,EAAE1B,OAAO,CAAC3F,IAAR,CAAa/H,MAFrB;AAGJqP,MAAAA,OAAO,EAAE3B,OAAO,CAACjM;AAHb,KAAR;AAKH;;AACD,SAAOyN,KAAP;AACH;;SCvBeI,gBAAgB1B,UAA8BC;AAC1D,MAAIC,SAAS,GAAGL,YAAY,EAA5B;AACA,MAAIE,QAAQ,GAAGG,SAAS,CAACH,QAAzB;AACA,MAAID,OAAO,GAAGI,SAAS,CAACJ,OAAxB;;AAEA,MAAI,CAACA,OAAD,IAAY,CAACA,OAAO,CAACjM,IAAzB,EAA+B;AAC3B,UAAM,IAAIsM,KAAJ,CACF,8DADE,CAAN;AAGH;;AAED,MAAIhD,IAAI,GAAGtM,UAAU,EAArB;;AACA,MAAIkP,QAAJ,EAAc;AACV5C,IAAAA,IAAI,CAACrM,KAAL,GAAaiP,QAAQ,CAACjP,KAAtB;AACAqM,IAAAA,IAAI,CAACpM,KAAL,GAAagP,QAAQ,CAAChP,KAAtB;AACH;;AAED,MAAI2O,eAAe,CAACO,IAAD,EAAOF,QAAP,aAAOA,QAAP,uBAAOA,QAAQ,CAAEjP,KAAjB,CAAnB,EAA4C;AACxCqM,IAAAA,IAAI,CAAChM,aAAL,CAAmBkC,IAAnB,CAAwB2M,QAAxB;AACA7C,IAAAA,IAAI,CAACrM,KAAL,GAAamP,IAAb;AACH;;AACDH,EAAAA,OAAO,CAACjM,IAAR,CAAapD,KAAb,CAAmB4C,IAAnB,CAAwB8J,IAAxB;AACA2C,EAAAA,OAAO,CAACpC,SAAR;AACH;;MCjBYiE,KAAK,GAAG,CAACxR,KAAD,EAAoBC,QAApB;AACjB,QAAM;AAAEmR,IAAAA,SAAF;AAAaC,IAAAA;AAAb,MAA4BH,gBAAgB,EAAlD;AACA,QAAMO,IAAI,GAAG,EACT,GAAGzR,KADM;AAETgC,IAAAA,KAAK,EAAEoP,SAFE;AAGTnP,IAAAA,MAAM,EAAEoP;AAHC,GAAb;AAKA,SAAOvR,2CAAa2R,OAAOxR,SAA3B;AACH,CARM;;MCMMyR,SAAS,GAAG,CAAC1R,KAAD,EAAwBC,QAAxB;AAErB,MAAIA,QAAQ,IAAIA,QAAQ,CAACsD,MAAT,GAAkB,CAAlC,EAAqC;AACjC,WAAOzD,cAACD,gBAAUI,SAAlB;AACH,GAFD,MAEO;AACH,WAAO,IAAP;AACH;AACJ,CAPM;;MCCM0R,MAAM,GAAG,CAAC3R,KAAD,EAAqBC,QAArB;AAElB,MAAIA,QAAQ,IAAIA,QAAQ,CAACsD,MAAT,GAAkB,CAAlC,EAAqC;AACjC,WAAOzD,cAACD,gBAAUI,SAAlB;AACH,GAFD,MAEO;AACH,WAAO,IAAP;AACH;AACJ,CAPM;;ACYP,MAAM2R,UAAU,GAAG7L,QAAQ,CAACjG,aAAT,CAAuB,QAAvB,CAAnB;AACA,MAAM+R,OAAO,GAAGD,UAAU,CAAC3L,UAAX,CAAsB,IAAtB,CAAhB;AAEA,MAAa6L,IAAI,GAAG,CAAC9R,KAAD,EAAmBC,QAAnB;AAChB,MAAIwR,IAAI,GAAa,EAAE,GAAGzR,KAAL;AAAY+G,IAAAA,IAAI,EAAE;AAAlB,GAArB;AAGA,MAAIA,IAAI,GAAG,EAAX;;AACA,MAAI9G,QAAQ,IAAIA,QAAQ,CAACsD,MAAT,GAAkB,CAAlC,EAAqC;AACjCwD,IAAAA,IAAI,GAAG9G,QAAQ,CAAC8R,IAAT,CAAc,GAAd,CAAP;AACH;;AACDN,EAAAA,IAAI,CAAC1K,IAAL,GAAYA,IAAZ;;AAGA,MAAI/G,KAAK,CAACoF,IAAV,EAAgB;AACZyM,IAAAA,OAAO,CAACG,YAAR,GAAuB,KAAvB;AACAH,IAAAA,OAAO,CAACzM,IAAR,GAAepF,KAAK,CAACoF,IAArB;AACA,QAAI4E,IAAI,GAAG6H,OAAO,CAAC5K,WAAR,CAAoBF,IAAI,IAAI,EAA5B,CAAX;;AACA,QAAIiD,IAAJ,EAAU;AACNyH,MAAAA,IAAI,CAAChF,eAAL,GAAuBzC,IAAI,CAAChI,KAA5B;AACAyP,MAAAA,IAAI,CAAC9E,gBAAL,GACI3C,IAAI,CAACiI,sBAAL,GAA8BjI,IAAI,CAACkI,qBADvC;AAEH;AACJ;;AAED,SAAOpS,0CAAY2R,MAAnB;AACH,CAvBM;;SC/BSU,eAAezO,MAAYxC,GAAWC;AAClD,MAAIuC,IAAI,CAACjD,KAAT,EAAgB;AACZiD,IAAAA,IAAI,CAACjD,KAAL,CAAWS,CAAX,IAAgBA,CAAhB;AACAwC,IAAAA,IAAI,CAACjD,KAAL,CAAWU,CAAX,IAAgBA,CAAhB;AACH;;AACD,OAAK,IAAI6B,KAAT,IAAkBU,IAAI,CAACzD,QAAvB,EAAiC;AAC7BkS,IAAAA,cAAc,CAACnP,KAAD,EAAQ9B,CAAR,EAAWC,CAAX,CAAd;AACH;AACJ;;SCFeiR,IAAIpS,OAAYC;AAC5BE,EAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBJ,KAAzB;AACAG,EAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4BH,QAA5B;AAGA,MAAIoS,cAAc,GAAGrS,KAAK,CAACqS,cAAN,GAAuBrS,KAAK,CAACqS,cAA7B,GAA8C,OAAnE;AACA,MAAIC,UAAU,GAAGtS,KAAK,CAACsS,UAAN,GAAmBtS,KAAK,CAACsS,UAAzB,GAAsC,OAAvD;AAEAf,EAAAA,eAAe,CAAC;AACZ,UAAM;AAAED,MAAAA;AAAF,QAAcJ,gBAAgB,EAApC;;AACA,QAAII,OAAJ,EAAa;AACT,UAAIpQ,CAAC,GAAGoQ,OAAO,CAAC7Q,KAAR,CAAeS,CAAvB;AACA,UAAIC,CAAC,GAAGmQ,OAAO,CAAC7Q,KAAR,CAAeU,CAAvB;AACA,UAAIa,KAAK,GAAkB,IAA3B;;AACA,UAAIhC,KAAK,CAACgC,KAAV,EAAiB;AACbA,QAAAA,KAAK,GAAGsP,OAAO,CAAC7Q,KAAR,CAAeuB,KAAvB;AACH;;AACD,UAAIC,MAAM,GAAkB,IAA5B;;AACA,UAAIjC,KAAK,CAACiC,MAAV,EAAkB;AACdA,QAAAA,MAAM,GAAGqP,OAAO,CAAC7Q,KAAR,CAAewB,MAAxB;AACH;;AACD,YAAMsQ,WAAW,GAAGjB,OAAO,CAACrR,QAAR,CAAiB,CAAjB,EAAoBA,QAAxC;AAEA,UAAIuS,YAAY,GAAG,CAAnB;AACA,UAAIC,UAAU,GAAG,CAAjB;AACA,UAAIC,WAAW,GAAG,CAAlB;AACA,UAAIC,SAAS,GAAG,CAAhB;AACA,UAAIC,cAAc,GAAG5Q,KAAK,GAAGA,KAAH,GAAW,CAArC;;AAGA,WAAK,IAAIgB,KAAT,IAAkBuP,WAAlB,EAA+B;AAC3B,YAAIvP,KAAK,CAAChD,KAAN,CAAY6S,IAAhB,EAAsB;AAClB,cAAI;AACA,gBAAIC,OAAO,GAAGC,QAAQ,CAAC/P,KAAK,CAAChD,KAAN,CAAY6S,IAAb,EAAmB,EAAnB,CAAtB;AACAF,YAAAA,SAAS,IAAIG,OAAb;AACH,WAHD,CAGE,OAAO3J,CAAP,EAAU;AACRhJ,YAAAA,OAAO,CAAC6S,IAAR,CAAa7J,CAAb;AACH;AACJ,SAPD,MAOO,IAAInG,KAAK,CAACvC,KAAV,EAAiB;AACpBmS,UAAAA,cAAc,IAAI5P,KAAK,CAACvC,KAAN,CAAYuB,KAA9B;AACH;AACJ;;AAGD,WAAK,IAAIgB,KAAT,IAAkBuP,WAAlB,EAA+B;AAC3BpS,QAAAA,OAAO,CAACC,GAAR,CACI,2BADJ,EAEI4C,KAAK,CAAC9C,IAFV,EAGI8C,KAAK,CAACvC,KAHV;;AAKA,YAAIuC,KAAK,CAACvC,KAAN,IAAeuC,KAAK,CAAChD,KAAN,CAAY6S,IAA3B,IAAmC7Q,KAAvC,EAA8C;AAC1C,cAAI;AACA,gBAAI8Q,OAAO,GAAGC,QAAQ,CAAC/P,KAAK,CAAChD,KAAN,CAAY6S,IAAb,EAAmB,EAAnB,CAAtB;AACA,gBAAII,SAAS,GAAGH,OAAO,GAAGH,SAA1B;AACA3P,YAAAA,KAAK,CAACvC,KAAN,CAAYuB,KAAZ,GAAoBiR,SAAS,GAAGL,cAAhC;AACAzS,YAAAA,OAAO,CAACC,GAAR,CACI,iBADJ,EAEI4C,KAAK,CAAC9C,IAFV,EAGI8C,KAAK,CAACvC,KAAN,CAAYuB,KAHhB,EAIIiR,SAJJ;AAMAR,YAAAA,UAAU,IAAIzP,KAAK,CAACvC,KAAN,CAAYuB,KAA1B;AACH,WAXD,CAWE,OAAOmH,CAAP,EAAU;AACRhJ,YAAAA,OAAO,CAAC6S,IAAR,CAAa7J,CAAb;AACH;AACJ;;AACD,YAAInG,KAAK,CAACvC,KAAV,EAAiB;AACbgS,UAAAA,UAAU,IAAIzP,KAAK,CAACvC,KAAN,CAAYuB,KAA1B;AACA0Q,UAAAA,WAAW,GAAG9Q,IAAI,CAAC8K,GAAL,CAASgG,WAAT,EAAsB1P,KAAK,CAACvC,KAAN,CAAYwB,MAAlC,CAAd;AACH,SAHD,MAGO;AACH9B,UAAAA,OAAO,CAAC6S,IAAR,CAAa,yBAAb,EAAwChQ,KAAxC;AACH;AACJ;;AAGD,UAAIhB,KAAK,KAAK,IAAd,EAAoB;AAChBA,QAAAA,KAAK,GAAGyQ,UAAR;AACAnB,QAAAA,OAAO,CAAC7Q,KAAR,CAAeuB,KAAf,GAAuBA,KAAvB;AACH;;AACDsP,MAAAA,OAAO,CAACrR,QAAR,CAAiB,CAAjB,EAAoBQ,KAApB,CAA2BuB,KAA3B,GAAmCA,KAAnC;;AAGA,UAAIC,MAAM,KAAK,IAAf,EAAqB;AACjBA,QAAAA,MAAM,GAAGyQ,WAAT;AACApB,QAAAA,OAAO,CAAC7Q,KAAR,CAAewB,MAAf,GAAwBA,MAAxB;AACH;;AACDqP,MAAAA,OAAO,CAACrR,QAAR,CAAiB,CAAjB,EAAoBQ,KAApB,CAA2BwB,MAA3B,GAAoCA,MAApC;;AAGA,cAAQoQ,cAAR;AACI,aAAK,YAAL;AACA,aAAK,OAAL;AAEI;;AACJ,aAAK,UAAL;AACA,aAAK,KAAL;AACInR,UAAAA,CAAC,GAAGA,CAAC,GAAGc,KAAJ,GAAYyQ,UAAhB;AACA;;AACJ,aAAK,QAAL;AACIvR,UAAAA,CAAC,GAAGA,CAAC,GAAG,CAACc,KAAK,GAAGyQ,UAAT,IAAuB,CAA/B;AACA;;AACJ,aAAK,eAAL;AACID,UAAAA,YAAY,GAAG,CAACxQ,KAAK,GAAGyQ,UAAT,KAAwBxS,QAAQ,CAACsD,MAAT,GAAkB,CAA1C,CAAf;AACA;;AACJ,aAAK,cAAL;AACIiP,UAAAA,YAAY,GAAG,CAACxQ,KAAK,GAAGyQ,UAAT,IAAuB,CAAtC;AACA;;AACJ,aAAK,cAAL;AACID,UAAAA,YAAY,GAAG,CAACxQ,KAAK,GAAGyQ,UAAT,KAAwBxS,QAAQ,CAACsD,MAAT,GAAkB,CAA1C,CAAf;AACA;AApBR;;AAwBA,WAAK,IAAIP,KAAT,IAAkBuP,WAAlB,EAA+B;AAC3B,YAAI,CAACvP,KAAK,CAACvC,KAAX,EAAkB;AACduC,UAAAA,KAAK,CAACvC,KAAN,GAAcsB,MAAM,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAApB;AACA5B,UAAAA,OAAO,CAAC+N,KAAR,CAAc,yBAAd,EAAyClL,KAAzC;AACH;;AACD,YAAIkQ,EAAE,GAAG/R,CAAT;AACA,YAAIgS,EAAE,GAAGnQ,KAAK,CAACvC,KAAN,CAAYwB,MAArB;;AACA,gBAAQqQ,UAAR;AACI,eAAK,YAAL;AACA,eAAK,OAAL;AAEI;;AACJ,eAAK,UAAL;AACA,eAAK,KAAL;AACIY,YAAAA,EAAE,GAAG/R,CAAC,GAAGc,MAAJ,GAAae,KAAK,CAACvC,KAAN,CAAYwB,MAA9B;AACA;;AACJ,eAAK,QAAL;AACA,eAAK,UAAL;AACIiR,YAAAA,EAAE,GAAG/R,CAAC,GAAG,CAACc,MAAM,GAAGe,KAAK,CAACvC,KAAN,CAAYwB,MAAtB,IAAgC,CAAzC;AACA;;AACJ,eAAK,SAAL;AACIkR,YAAAA,EAAE,GAAGlR,MAAL;AAEA;AAhBR;;AAmBAkQ,QAAAA,cAAc,CAACnP,KAAD,EAAQ9B,CAAR,EAAWgS,EAAX,CAAd;AACAlQ,QAAAA,KAAK,CAACvC,KAAN,CAAYwB,MAAZ,GAAqBkR,EAArB;AACAhT,QAAAA,OAAO,CAACC,GAAR,CAAY,yBAAZ,EAAuC4C,KAAK,CAAC9C,IAA7C,EAAmD8C,KAAK,CAACvC,KAAzD;AACAS,QAAAA,CAAC,IAAI8B,KAAK,CAACvC,KAAN,CAAYuB,KAAjB;AACAd,QAAAA,CAAC,IAAIsR,YAAL;AACH;AACJ;AACJ,GA1Ic,EA0IZ,CAACvS,QAAD,EAAWoS,cAAX,EAA2BC,UAA3B,CA1IY,CAAf;AA4IA,SAAOxS,cAACD,gBAAUI,SAAlB;AACH;;SCrJemT,OAAOpT,OAAYC;AAC/BE,EAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4BJ,KAA5B;AACAG,EAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA+BH,QAA/B;AAGA,MAAIoS,cAAc,GAAGrS,KAAK,CAACqS,cAAN,GAAuBrS,KAAK,CAACqS,cAA7B,GAA8C,OAAnE;AACA,MAAIC,UAAU,GAAGtS,KAAK,CAACsS,UAAN,GAAmBtS,KAAK,CAACsS,UAAzB,GAAsC,OAAvD;AAEAf,EAAAA,eAAe,CAAC;AACZ,UAAM;AAAED,MAAAA;AAAF,QAAcJ,gBAAgB,EAApC;;AACA,QAAII,OAAJ,EAAa;AACT,UAAIpQ,CAAC,GAAGoQ,OAAO,CAAC7Q,KAAR,CAAeS,CAAvB;AACA,UAAIC,CAAC,GAAGmQ,OAAO,CAAC7Q,KAAR,CAAeU,CAAvB;AACA,UAAIa,KAAK,GAAkB,IAA3B;;AACA,UAAIhC,KAAK,CAACgC,KAAV,EAAiB;AACbA,QAAAA,KAAK,GAAGsP,OAAO,CAAC7Q,KAAR,CAAeuB,KAAvB;AACH;;AACD,UAAIC,MAAM,GAAkB,IAA5B;;AACA,UAAIjC,KAAK,CAACiC,MAAV,EAAkB;AACdA,QAAAA,MAAM,GAAGqP,OAAO,CAAC7Q,KAAR,CAAewB,MAAxB;AACH;;AACD,YAAMsQ,WAAW,GAAGjB,OAAO,CAACrR,QAAR,CAAiB,CAAjB,EAAoBA,QAAxC;AAEA,UAAIuS,YAAY,GAAG,CAAnB;AACA,UAAIC,UAAU,GAAG,CAAjB;AACA,UAAIC,WAAW,GAAG,CAAlB;AACA,UAAIC,SAAS,GAAG,CAAhB;AACA,UAAIU,aAAa,GAAGpR,MAAM,GAAGA,MAAH,GAAY,CAAtC;;AAGA,WAAK,IAAIe,KAAT,IAAkBuP,WAAlB,EAA+B;AAC3B,YAAIvP,KAAK,CAAChD,KAAN,CAAY6S,IAAhB,EAAsB;AAClB,cAAI;AACA,gBAAIC,OAAO,GAAGC,QAAQ,CAAC/P,KAAK,CAAChD,KAAN,CAAY6S,IAAb,EAAmB,EAAnB,CAAtB;AACAF,YAAAA,SAAS,IAAIG,OAAb;AACH,WAHD,CAGE,OAAO3J,CAAP,EAAU;AACRhJ,YAAAA,OAAO,CAAC6S,IAAR,CAAa7J,CAAb;AACH;AACJ,SAPD,MAOO,IAAInG,KAAK,CAACvC,KAAV,EAAiB;AACpB4S,UAAAA,aAAa,IAAIrQ,KAAK,CAACvC,KAAN,CAAYwB,MAA7B;AACH;AACJ;;AAGD,WAAK,IAAIe,KAAT,IAAkBuP,WAAlB,EAA+B;AAC3BpS,QAAAA,OAAO,CAACC,GAAR,CACI,8BADJ,EAEI4C,KAAK,CAAC9C,IAFV,EAGI8C,KAAK,CAACvC,KAHV;;AAKA,YAAIuC,KAAK,CAACvC,KAAN,IAAeuC,KAAK,CAAChD,KAAN,CAAY6S,IAA3B,IAAmC5Q,MAAvC,EAA+C;AAC3C,cAAI;AACA,gBAAI6Q,OAAO,GAAGC,QAAQ,CAAC/P,KAAK,CAAChD,KAAN,CAAY6S,IAAb,EAAmB,EAAnB,CAAtB;AACA,gBAAII,SAAS,GAAGH,OAAO,GAAGH,SAA1B;AACA3P,YAAAA,KAAK,CAACvC,KAAN,CAAYwB,MAAZ,GAAqBgR,SAAS,GAAGI,aAAjC;AACAlT,YAAAA,OAAO,CAACC,GAAR,CACI,qBADJ,EAEI4C,KAAK,CAAC9C,IAFV,EAGI8C,KAAK,CAACvC,KAAN,CAAYwB,MAHhB,EAIIgR,SAJJ;AAMAP,YAAAA,WAAW,IAAI1P,KAAK,CAACvC,KAAN,CAAYwB,MAA3B;AACAwQ,YAAAA,UAAU,GAAG7Q,IAAI,CAAC8K,GAAL,CAAS+F,UAAT,EAAqBzP,KAAK,CAACvC,KAAN,CAAYuB,KAAjC,CAAb;AACH,WAZD,CAYE,OAAOmH,CAAP,EAAU;AACRhJ,YAAAA,OAAO,CAAC6S,IAAR,CAAa7J,CAAb;AACH;AACJ,SAhBD,MAgBO,IAAInG,KAAK,CAACvC,KAAV,EAAiB;AACpBiS,UAAAA,WAAW,IAAI1P,KAAK,CAACvC,KAAN,CAAYwB,MAA3B;AACAwQ,UAAAA,UAAU,GAAG7Q,IAAI,CAAC8K,GAAL,CAAS+F,UAAT,EAAqBzP,KAAK,CAACvC,KAAN,CAAYuB,KAAjC,CAAb;AACH,SAHM,MAGA;AACH7B,UAAAA,OAAO,CAAC+N,KAAR,CAAc,4BAAd,EAA4ClL,KAA5C;AACH;AACJ;;AAGD,UAAIhB,KAAK,KAAK,IAAd,EAAoB;AAChBA,QAAAA,KAAK,GAAGyQ,UAAR;AACAnB,QAAAA,OAAO,CAAC7Q,KAAR,CAAeuB,KAAf,GAAuBA,KAAvB;AACH;;AACDsP,MAAAA,OAAO,CAACrR,QAAR,CAAiB,CAAjB,EAAoBQ,KAApB,CAA2BuB,KAA3B,GAAmCA,KAAnC;;AAGA,UAAIC,MAAM,KAAK,IAAf,EAAqB;AACjBA,QAAAA,MAAM,GAAGyQ,WAAT;AACApB,QAAAA,OAAO,CAAC7Q,KAAR,CAAewB,MAAf,GAAwBA,MAAxB;AACH;;AACDqP,MAAAA,OAAO,CAACrR,QAAR,CAAiB,CAAjB,EAAoBQ,KAApB,CAA2BwB,MAA3B,GAAoCA,MAApC;;AAGA,cAAQoQ,cAAR;AACI,aAAK,YAAL;AACA,aAAK,OAAL;AAEI;;AACJ,aAAK,UAAL;AACA,aAAK,KAAL;AACIlR,UAAAA,CAAC,GAAGA,CAAC,GAAGc,MAAJ,GAAayQ,WAAjB;AACA;;AACJ,aAAK,QAAL;AACIvR,UAAAA,CAAC,GAAGA,CAAC,GAAG,CAACc,MAAM,GAAGyQ,WAAV,IAAyB,CAAjC;AACA;;AACJ,aAAK,eAAL;AACIF,UAAAA,YAAY,GACR,CAACvQ,MAAM,GAAGyQ,WAAV,KAA0BzS,QAAQ,CAACsD,MAAT,GAAkB,CAA5C,CADJ;AAEA;;AACJ,aAAK,cAAL;AACIiP,UAAAA,YAAY,GAAG,CAACvQ,MAAM,GAAGyQ,WAAV,IAAyB,CAAxC;AACA;;AACJ,aAAK,cAAL;AACIF,UAAAA,YAAY,GACR,CAACvQ,MAAM,GAAGyQ,WAAV,KAA0BzS,QAAQ,CAACsD,MAAT,GAAkB,CAA5C,CADJ;AAEA;AAtBR;;AA0BA,WAAK,IAAIP,KAAT,IAAkBuP,WAAlB,EAA+B;AAC3B,YAAI,CAACvP,KAAK,CAACvC,KAAX,EAAkB;AACduC,UAAAA,KAAK,CAACvC,KAAN,GAAcsB,MAAM,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAApB;AACA5B,UAAAA,OAAO,CAAC+N,KAAR,CAAc,4BAAd,EAA4ClL,KAA5C;AACH;;AACD,YAAIsQ,EAAE,GAAGpS,CAAT;AACA,YAAIqS,EAAE,GAAGvQ,KAAK,CAACvC,KAAN,CAAYuB,KAArB;;AACA,gBAAQsQ,UAAR;AACI,eAAK,YAAL;AACA,eAAK,OAAL;AAEI;;AACJ,eAAK,UAAL;AACA,eAAK,KAAL;AACIgB,YAAAA,EAAE,GAAGpS,CAAC,GAAGc,KAAJ,GAAYgB,KAAK,CAACvC,KAAN,CAAYuB,KAA7B;AACA;;AACJ,eAAK,QAAL;AACA,eAAK,UAAL;AACIsR,YAAAA,EAAE,GAAGpS,CAAC,GAAG,CAACc,KAAK,GAAGgB,KAAK,CAACvC,KAAN,CAAYuB,KAArB,IAA8B,CAAvC;AACA;;AACJ,eAAK,SAAL;AACIuR,YAAAA,EAAE,GAAGvR,KAAL;AAEA;AAhBR;;AAmBAmQ,QAAAA,cAAc,CAACnP,KAAD,EAAQsQ,EAAR,EAAYnS,CAAZ,CAAd;AACA6B,QAAAA,KAAK,CAACvC,KAAN,CAAYuB,KAAZ,GAAoBuR,EAApB;AACApT,QAAAA,OAAO,CAACC,GAAR,CACI,4BADJ,EAEI4C,KAAK,CAAC9C,IAFV,EAGI8C,KAAK,CAACvC,KAHV;AAKAU,QAAAA,CAAC,IAAI6B,KAAK,CAACvC,KAAN,CAAYwB,MAAjB;AACAd,QAAAA,CAAC,IAAIqR,YAAL;AACH;AACJ;AACJ,GAhJc,EAgJZ,CAACvS,QAAD,EAAWoS,cAAX,EAA2BC,UAA3B,CAhJY,CAAf;AAkJA,SAAOxS,cAACD,gBAAUI,SAAlB;AACH;;MChJYuT,OAAO,GAAG,CAACxT,KAAD,EAAsBC,QAAtB;AAEnB,MAAIA,QAAQ,IAAIA,QAAQ,CAACsD,MAAT,GAAkB,CAAlC,EAAqC;AACjC,WAAOzD,cAACD,gBAAUI,SAAlB;AACH,GAFD,MAEO;AACH,WAAO,IAAP;AACH;AACJ,CAPM;;MCCMwT,IAAI,GAAG,CAACzT,KAAD,EAAmBC,QAAnB;AAEhB,MAAIA,QAAQ,IAAIA,QAAQ,CAACsD,MAAT,GAAkB,CAAlC,EAAqC;AACjC,WAAOzD,cAACD,gBAAUI,SAAlB;AACH,GAFD,MAEO;AACH,WAAO,IAAP;AACH;AACJ,CAPM;;MCNMyT,KAAK,GAAG,CAAC1T,KAAD,EAAoBC,QAApB;AAEjB,MAAIA,QAAQ,IAAIA,QAAQ,CAACsD,MAAT,GAAkB,CAAlC,EAAqC;AACjC,WAAOzD,cAACD,gBAAUI,SAAlB;AACH,GAFD,MAEO;AACH,WAAO,IAAP;AACH;AACJ,CAPM;;;;"}